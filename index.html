<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>üê± NEKOPON Quiz üê±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-brown: #8b4513;
            --light-brown: #d2691e;
            --cream: #faf8f5;
            --white: #ffffff;
            --soft-orange: #ff7f50;
            --gold: #ffd700;
            --pink: #ffb6c1;
            --shadow: rgba(139,69,19,0.25);
            --neon-pink: #ff1493;
            --neko-blue: #00bfff;
            --neko-green: #00ff00;
        }
        
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background: var(--cream);
            color: var(--primary-brown);
            font-weight: 700;
            min-height: 100vh;
            touch-action: manipulation;
            overflow-x: hidden;
            -webkit-text-size-adjust: none;
            -moz-text-size-adjust: none;
            -ms-text-size-adjust: none;
            text-size-adjust: none;
            cursor: pointer;
            position: relative;
        }
        
        .container-spacing {
            margin: 0 auto;
            max-width: 95%;
            width: 100%;
        }
        
        @media (min-width: 640px) {
            .container-spacing {
                max-width: 500px;
            }
        }
        
        @media (min-width: 768px) {
            .container-spacing {
                max-width: 600px;
            }
        }
        
        @media (min-width: 1024px) {
            .container-spacing {
                max-width: 700px;
            }
        }
        
        /* Ê®™‰∏¶„Å≥„Çπ„Ç≥„Ç¢Ë°®Á§∫ÔºàNEKOPONÈ¢®Ôºâ */
        .horizontal-points-display {
            position: fixed !important;
            bottom: 20px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            z-index: 9999 !important;
            display: flex !important;
            gap: 12px !important;
            pointer-events: none;
            background: rgba(255,255,255,0.35);
            padding: 8px 24px;
            border-radius: 25px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(139,69,19,0.15), inset 0 1px 0 rgba(255,255,255,0.3);
            animation: header-enter 1.2s ease-out 0.8s forwards;
            opacity: 0;
        }
        
        @keyframes header-enter {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px) scale(0.9); }
            100% { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
        }
        
        .point-bubble {
            background: transparent;
            border: none;
            border-radius: 15px;
            padding: 5px 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-brown);
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .point-bubble:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }
        
        /* „Ç¢„Ç§„Ç≥„É≥„ÅÆ„Åø„ÅÆÂõûËª¢Áî®„ÇØ„É©„Çπ */
        .rotating-icon, .auto-rotating-emoji {
            display: inline-block;
            transition: transform 0.1s ease-out;
            --rotation: 0deg;
        }
        
        .rotating-icon:not(.animating):not(.bounce), .auto-rotating-emoji:not(.animating):not(.bounce) {
            transform: rotate(var(--rotation)) !important;
        }
        
        .point-bubble:nth-child(1):not(.tap-sparkle) .rotating-icon, .point-bubble:nth-child(1):not(.tap-sparkle) .auto-rotating-emoji {
            animation: gentle-sparkle 4s ease-in-out 3s infinite;
        }
        
        .point-bubble:nth-child(2):not(.tap-fire) .rotating-icon, .point-bubble:nth-child(2):not(.tap-fire) .auto-rotating-emoji {
            animation: gentle-fire 3.5s ease-in-out 3.5s infinite;
        }
        
        .point-bubble:nth-child(3):not(.tap-trophy) .rotating-icon, .point-bubble:nth-child(3):not(.tap-trophy) .auto-rotating-emoji {
            animation: gentle-trophy 5s ease-in-out 4s infinite;
        }
        
        .point-bubble.tap-sparkle .rotating-icon, .point-bubble.tap-sparkle .auto-rotating-emoji {
            animation: tap-sparkle 0.8s ease-out !important;
        }
        
        .point-bubble.tap-fire .rotating-icon, .point-bubble.tap-fire .auto-rotating-emoji {
            animation: tap-fire 0.8s ease-out !important;
        }
        
        .point-bubble.tap-trophy .rotating-icon, .point-bubble.tap-trophy .auto-rotating-emoji {
            animation: tap-trophy 0.8s ease-out !important;
        }
        
        @keyframes gentle-sparkle {
            0%, 100% { filter: brightness(1); transform: scale(1) rotate(var(--rotation)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 5px gold); transform: scale(1.02) rotate(calc(var(--rotation) + 5deg)); }
        }
        
        @keyframes gentle-fire {
            0%, 100% { filter: brightness(1); transform: scale(1) rotate(var(--rotation)); }
            33% { filter: brightness(1.3) hue-rotate(15deg); transform: scale(1.03) rotate(calc(var(--rotation) + 3deg)); }
            66% { filter: brightness(1.1) hue-rotate(-10deg); transform: scale(1.01) rotate(calc(var(--rotation) - 3deg)); }
        }
        
        @keyframes gentle-trophy {
            0%, 100% { filter: brightness(1); transform: scale(1) rotate(var(--rotation)); }
            50% { filter: brightness(1.4) drop-shadow(0 0 8px orange); transform: scale(1.04) rotate(calc(var(--rotation) + 4deg)); }
        }
        
        @keyframes tap-sparkle {
            0% { transform: scale(1) rotate(var(--rotation)); filter: brightness(1); }
            30% { transform: scale(1.4) rotate(calc(var(--rotation) + 15deg)); filter: brightness(2) drop-shadow(0 0 20px gold) saturate(2); }
            60% { transform: scale(1.2) rotate(calc(var(--rotation) + 5deg)); filter: brightness(1.8) drop-shadow(0 0 15px gold); }
            100% { transform: scale(1) rotate(var(--rotation)); filter: brightness(1); }
        }
        
        @keyframes tap-fire {
            0% { transform: scale(1) rotate(var(--rotation)); filter: brightness(1); }
            25% { transform: scale(1.5) rotate(calc(var(--rotation) + 20deg)); filter: brightness(3) hue-rotate(90deg) saturate(3); }
            50% { transform: scale(1.3) rotate(calc(var(--rotation) - 10deg)); filter: brightness(2.5) hue-rotate(45deg) saturate(2); }
            75% { transform: scale(1.1) rotate(calc(var(--rotation) + 8deg)); filter: brightness(1.8) hue-rotate(20deg); }
            100% { transform: scale(1) rotate(var(--rotation)); filter: brightness(1); }
        }
        
        @keyframes tap-trophy {
            0% { transform: scale(1) rotate(var(--rotation)); filter: brightness(1); }
            20% { transform: scale(1.6) translateY(-5px) rotate(calc(var(--rotation) + 25deg)); filter: brightness(4) drop-shadow(0 0 25px orange) saturate(3); }
            40% { transform: scale(1.4) translateY(-2px) rotate(calc(var(--rotation) - 15deg)); filter: brightness(3) drop-shadow(0 0 20px gold); }
            60% { transform: scale(1.2) translateY(0px) rotate(calc(var(--rotation) + 10deg)); filter: brightness(2) drop-shadow(0 0 15px orange); }
            80% { transform: scale(1.05) translateY(0px) rotate(calc(var(--rotation) - 3deg)); filter: brightness(1.5); }
            100% { transform: scale(1) translateY(0px) rotate(var(--rotation)); filter: brightness(1); }
        }
        
        /* „ÇØ„É™„ÉÉ„Ç´„Éñ„É´„Å™Ë¶ÅÁ¥†„ÅÆÂü∫Êú¨„Çπ„Çø„Ç§„É´ */
        .clickable-element {
            cursor: pointer !important;
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
            position: relative;
            overflow: visible;
            pointer-events: auto !important;
        }
        
        .clickable-element:hover {
            transform: scale(1.05) !important;
            filter: brightness(1.2) !important;
        }
        
        .clickable-element:active {
            transform: scale(0.95) !important;
        }
        
        /* ÂèØÊÑõ„ÅÑÈúá„Åà„Ç®„Éï„Çß„ÇØ„Éà */
        .cute-shake-effect {
            animation: cute-shake 0.6s ease-in-out !important;
        }
        
        @keyframes cute-shake {
            0%, 100% { transform: scale(1); }
            10% { transform: scale(1.1); }
            20% { transform: scale(0.95); }
            30% { transform: scale(1.08); }
            40% { transform: scale(0.98); }
            50% { transform: scale(1.05); }
            60% { transform: scale(0.99); }
            70% { transform: scale(1.02); }
            80% { transform: scale(0.995); }
            90% { transform: scale(1.01); }
        }
        
        /* „Ç≤„Éº„É†„Çø„Ç§„Éà„É´ */
        .game-title {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
            font-size: clamp(1.4rem, 4vw, 2rem);
            text-align: center;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            user-select: none;
            opacity: 0;
            animation: title-enter 1.5s ease-out 0.2s forwards;
            white-space: normal;
            overflow: visible;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .game-title-text {
            background: linear-gradient(45deg, var(--light-brown), var(--soft-orange), var(--gold));
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        @keyframes title-enter {
            0% { opacity: 0; transform: translateY(-30px) scale(0.8); }
            60% { opacity: 1; transform: translateY(5px) scale(1.1); }
            80% { transform: translateY(-2px) scale(1.05); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .game-title.title-bounce {
            animation: title-mega-bounce 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
        }
        
        @keyframes title-mega-bounce {
            0% { transform: scale(1); }
            20% { transform: scale(1.15); }
            40% { transform: scale(0.95); }
            60% { transform: scale(1.1); }
            80% { transform: scale(0.98); }
            100% { transform: scale(1); }
        }
        
        /* Áå´„Ç¢„Ç§„Ç≥„É≥ */
        .cat-icon {
            color: #8b4513;
            display: inline-block;
            cursor: pointer;
            font-size: clamp(28px, 4vw, 40px);
            margin: 0 8px;
            transition: all 0.1s ease-out;
            --rotation: 0deg;
        }
        
        .cat-icon:hover {
            transform: scale(1.4) rotate(calc(var(--rotation) + 15deg)) !important;
            filter: drop-shadow(0 0 15px var(--neko-pink)) brightness(1.5) !important;
        }
        
        .cat-icon.bounce {
            animation: cat-mega-bounce 0.8s ease-in-out !important;
        }
        
        .cat-icon:not(.bounce) {
            transform: rotate(var(--rotation));
        }
        
        @keyframes cat-mega-bounce {
            0%, 100% { transform: scale(1) rotate(var(--rotation)); }
            25% { transform: scale(1.6) rotate(calc(var(--rotation) + 20deg)); }
            50% { transform: scale(1.8) rotate(calc(var(--rotation) - 15deg)); }
            75% { transform: scale(1.4) rotate(calc(var(--rotation) + 10deg)); }
        }
        
        /* Â∞è„Åï„Å™„Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éù„Ç§„É≥„ÉàË°®Á§∫ */
        .floating-points {
            position: absolute;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-size: 16px;
            font-weight: 700;
            pointer-events: none;
            z-index: 8000;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
            animation: float-points 2s ease-out forwards;
            white-space: nowrap;
        }
        
        .floating-points.normal {
            color: var(--soft-orange);
        }
        
        .floating-points.bonus {
            font-size: 18px;
            color: var(--neko-pink);
        }
        
        .floating-points.mega {
            font-size: 20px;
            color: var(--neko-blue);
        }
        
        .floating-points.ultra {
            font-size: 22px;
            background: linear-gradient(45deg, var(--neko-pink), var(--neko-blue), var(--neko-green), var(--gold));
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        @keyframes float-points {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(1.2); }
        }
        
        /* Â∞è„Åï„Å™„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ */
        .cute-particle {
            position: absolute;
            font-size: 14px;
            pointer-events: none;
            z-index: 7000;
            animation: cute-particle-burst 1.5s ease-out forwards;
        }
        
        @keyframes cute-particle-burst {
            0% { opacity: 1; transform: scale(0) rotate(0deg); }
            20% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(360deg) translateY(-80px); }
        }
        
        .clean-card {
            background: var(--white);
            border: 2px solid var(--light-brown);
            border-radius: 20px;
            box-shadow: 0 8px 24px var(--shadow);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .clean-button {
            background: var(--light-brown);
            border: none;
            color: white;
            font-weight: 700;
            border-radius: 25px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 12px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            pointer-events: auto !important;
        }
        
        .clean-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow);
            background: var(--soft-orange);
        }
        
        .clean-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .clean-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .subject-btn, .category-btn {
            background: var(--white);
            border: 3px solid var(--light-brown);
            border-radius: 15px;
            color: var(--primary-brown);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
            cursor: pointer;
            text-align: center;
            pointer-events: auto !important;
            z-index: 100;
        }
        
        .subject-btn:hover, .category-btn:hover {
            border-color: var(--soft-orange);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 28px var(--shadow);
            background: #fff8f0;
        }
        
        .subject-btn.active, .category-btn.active {
            background: #ffe4cc;
            border-color: var(--soft-orange);
            color: var(--soft-orange);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 28px var(--shadow);
        }
        
        .category-btn {
            padding: 0.5rem 0.75rem !important;
            min-height: 50px !important;
            font-size: 0.85rem !important;
            line-height: 1.2 !important;
        }
        
        .category-btn:hover {
            transform: translateY(-2px) scale(1.01) !important;
        }
        
        .category-btn.active {
            transform: translateY(-2px) scale(1.01) !important;
        }
        
        /* „Ç¢„Ç§„Ç≥„É≥ÈÉ®ÂàÜ„Å†„ÅëÂõûËª¢„Åï„Åõ„Çã */
        .subject-icon, .category-icon {
            display: inline-block;
            transition: transform 0.1s ease-out;
            --rotation: 0deg;
        }
        
        .subject-icon:not(.animating):not(.bounce), .category-icon:not(.animating):not(.bounce) {
            transform: rotate(var(--rotation)) !important;
        }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(139,69,19,0.4);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            z-index: 5000;
            padding: 1rem;
        }
        
        .modal.show {
            display: flex;
            animation: modalFadeIn 0.5s ease-out;
        }
        
        .modal.unit-modal {
            align-items: flex-start;
            padding: 0.5rem;
            overflow-y: auto;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .floating-msg {
            position: absolute;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-brown);
            pointer-events: none;
            z-index: 7500;
            animation: float-up 2s ease-out forwards;
            text-shadow: 1px 1px 4px rgba(255,255,255,0.8);
            white-space: nowrap;
        }
        
        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(1.2); }
        }
        
        .quiz-option {
            background: var(--white);
            border: 3px solid var(--light-brown);
            color: var(--primary-brown);
            border-radius: 15px;
            padding: 0.75rem 1rem;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-weight: 700;
            font-size: 0.9rem;
            position: relative;
            box-shadow: 0 4px 12px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
        }
        
        .quiz-option:hover {
            border-color: var(--soft-orange);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow);
            background: #fff8f0;
        }
        
        .quiz-explanation {
            height: 150px;
            background: #fff8f0;
            border-radius: 15px;
            padding: 0.75rem;
            margin-top: 1rem;
            border: 3px solid var(--light-brown);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            text-align: center;
            overflow-y: auto;
            box-sizing: border-box;
            font-size: 1rem;
            line-height: 1.4;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
        }
        
        .quiz-explanation p {
            margin: 0;
            padding: 0;
            word-wrap: break-word;
            max-height: 100%;
            overflow: hidden;
            font-size: 1rem;
        }
        
        .quiz-explanation.has-content {
            border-color: var(--soft-orange);
            background: #ffe4cc;
        }
        
        .back-button {
            background: #f8f4f0;
            border: 2px solid var(--light-brown);
            color: var(--primary-brown);
            border-radius: 15px;
            padding: 0.5rem 1rem;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-size: 0.9rem;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
        }
        
        .back-button:hover {
            background: #fff8f0;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
        }
        
        .mode-btn {
            background: var(--white);
            border: 3px solid var(--light-brown);
            border-radius: 12px;
            color: var(--primary-brown);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            padding: 0.5rem;
            font-size: 0.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
        }
        
        .mode-btn:hover {
            border-color: var(--soft-orange);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
            background: #fff8f0;
        }
        
        .mode-btn.active {
            background: #ffe4cc;
            border-color: var(--soft-orange);
            color: var(--soft-orange);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
        }
        
        /* „É¢„Éº„Éâ„Ç¢„Ç§„Ç≥„É≥„ÇÇÂõûËª¢ */
        .mode-icon {
            display: inline-block;
            margin-right: 4px;
            transition: transform 0.1s ease-out;
            --rotation: 0deg;
        }
        
        .mode-icon:not(.animating):not(.bounce) {
            transform: rotate(var(--rotation)) !important;
        }
        
        .stats-display {
            background: #fff8f0;
            border: 2px solid var(--light-brown);
            border-radius: 20px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .floating-button {
            position: fixed !important;
            bottom: 20px !important;
            left: 20px !important;
            right: auto !important;
            margin: 0 !important;
            transform: none !important;
            width: 56px;
            height: 56px;
            background: var(--light-brown);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px var(--shadow);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 9998;
            cursor: pointer;
        }
        
        .floating-button.hidden {
            display: none !important;
        }
        
        .floating-button:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 24px var(--shadow);
            background: var(--soft-orange);
        }
        
        /* Èü≥Â£∞Ë®≠ÂÆö„Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éú„Çø„É≥ */
        .voice-floating-button {
            position: fixed !important;
            bottom: 20px !important;
            right: 20px !important;
            width: 56px;
            height: 56px;
            background: var(--soft-orange);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px var(--shadow);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 9997;
            cursor: pointer;
        }
        
        .voice-floating-button:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 24px var(--shadow);
            background: var(--gold);
        }
        
        /* „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éú„Çø„É≥„ÅÆ„Ç¢„Ç§„Ç≥„É≥„ÇÇÂõûËª¢ */
        .floating-button-icon {
            display: inline-block;
            transition: transform 0.1s ease-out;
            --rotation: 0deg;
        }
        
        .floating-button-icon:not(.animating):not(.bounce) {
            transform: rotate(var(--rotation)) !important;
        }
        
        /* Èü≥Â£∞Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´ */
        .voice-modal-content {
            max-width: 500px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
        }
        
        .voice-modal-padding {
            padding: 4rem 1rem 3rem 1rem;
        }
        
        .voice-section {
            margin-bottom: 1.5rem;
        }
        
        .voice-section h3 {
            color: var(--primary-brown);
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            text-align: center;
            padding-bottom: 0.4rem;
        }
        
        .voice-option {
            background: var(--white);
            border: 2px solid var(--light-brown);
            border-radius: 12px;
            padding: 0.75rem;
            margin-bottom: 0.6rem;
            display: grid;
            grid-template-columns: 1fr auto;
            grid-template-rows: auto auto;
            gap: 0.5rem;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            min-height: 70px;
        }
        
        .voice-option:hover {
            border-color: var(--soft-orange);
            background: #fff8f0;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .voice-option.selected {
            background: #ffe4cc;
            border-color: var(--soft-orange);
            color: var(--soft-orange);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .voice-info {
            grid-column: 1;
            grid-row: 1 / 3;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: left;
        }
        
        .voice-name {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.3rem;
            line-height: 1.2;
            color: var(--primary-brown);
        }
        
        .voice-description {
            font-size: 0.85rem;
            color: var(--light-brown);
            opacity: 0.9;
            line-height: 1.3;
        }
        
        .voice-controls {
            grid-column: 2;
            grid-row: 1 / 3;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voice-test-btn {
            background: var(--light-brown);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            white-space: nowrap;
            min-width: 90px;
        }
        
        .voice-test-btn:hover {
            background: var(--soft-orange);
            transform: scale(1.05);
        }
        
        .voice-switch {
            background: var(--white);
            border: 2px solid var(--light-brown);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .switch-container {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        
        .switch-input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        
        .switch-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .switch-input:checked + .switch-slider {
            background-color: var(--light-brown);
        }
        
        .switch-input:focus + .switch-slider {
            box-shadow: 0 0 1px var(--light-brown);
        }
        
        .switch-input:checked + .switch-slider:before {
            transform: translateX(22px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            color: var(--primary-brown);
            padding: 12px 16px;
            border-radius: 20px;
            border: 2px solid var(--light-brown);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 9001;
            box-shadow: 0 6px 20px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .subject-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }
        
        .category-grid {
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)) !important;
            gap: 0.4rem !important;
        }
        
        .section-divider {
            height: 2px;
            background: var(--light-brown);
            margin: 1rem 0;
            border-radius: 1px;
        }
        
        .grade-label {
            font-size: 0.7rem !important;
            font-weight: 700;
            color: var(--light-brown);
            text-align: center;
            margin: 0.5rem 0 0.3rem 0 !important;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .score-pulse {
            animation: score-pulse 0.6s ease-in-out;
        }
        
        @keyframes score-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); filter: brightness(1.3); }
        }
        
        .tap-effect {
            position: relative;
            overflow: visible;
        }
        
        .tap-effect::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--gold);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            pointer-events: none;
            z-index: 6000;
        }
        
        .tap-effect.tapped::after {
            animation: tap-ripple 0.6s ease-out;
        }
        
        @keyframes tap-ripple {
            0% { width: 0; height: 0; opacity: 0.8; }
            100% { width: 200px; height: 200px; opacity: 0; }
        }
        
        .subject-modal-content {
            max-height: 85vh;
            overflow-y: auto;
            padding-top: 0;
        }
        
        .modal .clean-card {
            margin: 2rem 1rem 1rem 1rem;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .modal.unit-modal .clean-card {
            margin: 0.25rem 1rem 6rem 1rem;
            max-height: 94vh;
            overflow-y: auto;
            padding: 1rem 1rem 2rem 1rem;
        }
        
        /* ÈáçÂäõÊÑüÁü•„ÅÆ„Åü„ÇÅ„ÅÆÊ®©ÈôêË¶ÅÊ±Ç„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó */
        .permission-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 25px 15px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(139,69,19,0.25);
            z-index: 10000;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            text-align: center;
            max-width: 90vw;
            width: auto;
            line-height: 1.6;
            border: 1px solid rgba(255,255,255,0.3);
            opacity: 0;
            display: none;
        }
        
        .permission-popup.show {
            display: block;
            animation: popup-enter 0.8s ease-out forwards;
        }
        
        @keyframes popup-enter {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) rotate(-5deg); }
            60% { opacity: 1; transform: translate(-50%, -50%) scale(1.05) rotate(2deg); }
            80% { transform: translate(-50%, -50%) scale(0.98) rotate(-1deg); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }
        
        .permission-popup h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: #8b4513;
            white-space: nowrap;
        }
        
        .permission-popup p {
            font-size: 15px;
            margin-bottom: 20px;
            color: #a0522d;
            line-height: 1.4;
            white-space: nowrap;
        }
        
        .permission-popup button {
            background: linear-gradient(145deg, #d2691e, #ff7f50);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            margin: 8px 6px;
            width: 120px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(210,105,30,0.3);
        }
        
        .permission-popup button:hover {
            background: linear-gradient(145deg, #ff7f50, #ff6347);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(210,105,30,0.4);
        }
        
        @media (max-width: 640px) {
            .container-spacing {
                max-width: 95%;
                margin-bottom: 2rem;
            }
            
            .horizontal-points-display {
                bottom: 15px !important;
                gap: 8px;
                padding: 6px 20px;
            }
            
            .point-bubble {
                font-size: 14px;
                padding: 4px 6px;
                gap: 4px;
            }
            
            .modal .clean-card {
                margin: 1.5rem 0.25rem 0.25rem 0.25rem;
                padding: 0.75rem;
                max-height: 92vh;
            }
            
            .modal.unit-modal .clean-card {
                margin: 0.1rem 0.25rem 6rem 0.25rem !important;
                padding: 0.6rem 0.75rem 3rem 0.75rem !important;
                max-height: 98vh !important;
            }
            
            .floating-button {
                bottom: 20px !important;
                left: 20px !important;
                right: auto !important;
                width: 52px;
                height: 52px;
                font-size: 20px;
            }
            
            .voice-floating-button {
                bottom: 20px !important;
                right: 20px !important;
                width: 52px;
                height: 52px;
                font-size: 20px;
            }
        }
        
        button, .subject-btn, .category-btn, .quiz-option, .clean-button, .back-button, .mode-btn {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
        }
        
        * {
            touch-action: manipulation;
        }
        
        input, select, textarea {
            font-size: 16px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center pt-6 pb-12 gap-6 relative">
    <!-- Ê®™‰∏¶„Å≥„Éù„Ç§„É≥„ÉàË°®Á§∫ÔºàÁîªÈù¢‰∏ãÈÉ®‰∏≠Â§ÆÔºâ -->
    <div class="horizontal-points-display">
        <div class="point-bubble clickable-element" id="sparklePointBubble">
            <span class="rotating-icon">‚ú®</span>
            <span id="sparklePointsMain">0</span>
        </div>
        <div class="point-bubble clickable-element" id="firePointBubble">
            <span class="rotating-icon">üî•</span>
            <span id="firePointsMain">0</span>
        </div>
        <div class="point-bubble clickable-element" id="trophyPointBubble">
            <span class="rotating-icon">üèÜ</span>
            <span id="trophyPointsMain">0</span>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„ÅÆÊïôÁßëÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="mainSubjectModal" class="modal show">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-6">
                <h1 class="game-title clickable-element" id="gameTitle">
                    <span class="cat-icon clickable-element" id="leftCat">üê±</span>
                    <span class="game-title-text">NEKOPON Quiz</span>
                    <span class="cat-icon clickable-element" id="rightCat">üê±</span>
                </h1>
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üìö</span> ÊïôÁßë„ÇíÈÅ∏„Å∂„Å´„ÇÉ„Äú‚ô™
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åó„Åü„ÅÑÊïôÁßë„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>„Å©„Åì„Åß„ÇÇ„ÇØ„É™„ÉÉ„ÇØ„Åß„Éù„Ç§„É≥„Éà„Ç≤„ÉÉ„Éà„Å´„ÇÉ„Äú<span class="rotating-icon">‚ú®</span></p>
            </div>
            <div class="grid subject-grid mb-6">
                <button class="subject-btn tap-effect clickable-element" data-subject="social" onclick="selectSubject('social')">
                    <div class="subject-icon text-2xl mb-1">üåç</div>
                    <div class="subject-name font-semibold text-sm">Á§æ‰ºö</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-subject="science" onclick="selectSubject('science')">
                    <div class="subject-icon text-2xl mb-1">üî¨</div>
                    <div class="subject-name font-semibold text-sm">ÁêÜÁßë</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-subject="english" onclick="selectSubject('english')">
                    <div class="subject-icon text-2xl mb-1">üìñ</div>
                    <div class="subject-name font-semibold text-sm">Ëã±Ë™û</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Á§æ‰ºö„É¢„Éº„ÉÄ„É´ -->
    <div id="socialModal" class="modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-6">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üåç</span> Á§æ‰ºö
                </h2>
                <p class="text-gray-600 text-sm clickable-element">ÂàÜÈáé„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™</p>
            </div>
            <div class="grid subject-grid mb-6">
                <button class="subject-btn tap-effect clickable-element" data-category="geography" onclick="selectCategory('geography')">
                    <div class="subject-icon text-2xl mb-1">üó∫Ô∏è</div>
                    <div class="subject-name font-semibold text-sm">Âú∞ÁêÜ</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-category="history" onclick="selectCategory('history')">
                    <div class="subject-icon text-2xl mb-1">üèõÔ∏è</div>
                    <div class="subject-name font-semibold text-sm">Ê≠¥Âè≤</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-category="civics" onclick="selectCategory('civics')">
                    <div class="subject-icon text-2xl mb-1">‚öñÔ∏è</div>
                    <div class="subject-name font-semibold text-sm">ÂÖ¨Ê∞ë</div>
                </button>
            </div>
            <div class="text-center">
                <button class="back-button tap-effect clickable-element" onclick="goBackToMain()">
                    ‚Üê ÊïôÁßëÈÅ∏Êäû„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- ÁêÜÁßë„É¢„Éº„ÉÄ„É´ -->
    <div id="scienceModal" class="modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-6">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üî¨</span> ÁêÜÁßë
                </h2>
                <p class="text-gray-600 text-sm clickable-element">ÂàÜÈáé„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™</p>
            </div>
            <div class="grid subject-grid mb-6">
                <button class="subject-btn tap-effect clickable-element" data-category="chemistry" onclick="selectCategory('chemistry')">
                    <div class="subject-icon text-2xl mb-1">üß™</div>
                    <div class="subject-name font-semibold text-sm">ÂåñÂ≠¶</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-category="biology" onclick="selectCategory('biology')">
                    <div class="subject-icon text-2xl mb-1">üß¨</div>
                    <div class="subject-name font-semibold text-sm">ÁîüÁâ©</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-category="physics" onclick="selectCategory('physics')">
                    <div class="subject-icon text-2xl mb-1">‚öõÔ∏è</div>
                    <div class="subject-name font-semibold text-sm">Áâ©ÁêÜ</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-category="earth" onclick="selectCategory('earth')">
                    <div class="subject-icon text-2xl mb-1">üåç</div>
                    <div class="subject-name font-semibold text-sm">Âú∞Â≠¶</div>
                </button>
            </div>
            <div class="text-center">
                <button class="back-button tap-effect clickable-element" onclick="goBackToMain()">
                    ‚Üê ÊïôÁßëÈÅ∏Êäû„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ëã±Ë™û„É¢„Éº„ÉÄ„É´ -->
    <div id="englishModal" class="modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-6">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üìñ</span> Ëã±Ë™û
                </h2>
                <p class="text-gray-600 text-sm clickable-element">ÂàÜÈáé„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™</p>
            </div>
            <div class="grid subject-grid mb-6">
                <button class="subject-btn tap-effect clickable-element" data-category="english_words" onclick="selectCategory('english_words')">
                    <div class="subject-icon text-2xl mb-1">üìù</div>
                    <div class="subject-name font-semibold text-sm">Ëã±ÂçòË™û</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-category="english_phrases" onclick="selectCategory('english_phrases')">
                    <div class="subject-icon text-2xl mb-1">üí¨</div>
                    <div class="subject-name font-semibold text-sm">Ëã±ÁÜüË™û</div>
                </button>
                <button class="subject-btn tap-effect clickable-element" data-category="english_grammar" onclick="selectCategory('english_grammar')">
                    <div class="subject-icon text-2xl mb-1">üìò</div>
                    <div class="subject-name font-semibold text-sm">Ë™ûÂΩ¢Â§âÂåñ</div>
                </button>
            </div>
            <div class="text-center">
                <button class="back-button tap-effect clickable-element" onclick="goBackToMain()">
                    ‚Üê ÊïôÁßëÈÅ∏Êäû„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Âú∞ÁêÜ„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="geographyModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üó∫Ô∏è</span> Âú∞ÁêÜ
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="geographyCategories"></div>
            <div class="text-center space-y-2">
                <button id="startGeographyQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('geography', 'üó∫Ô∏è Âú∞ÁêÜ')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToSocial()">
                    ‚Üê Á§æ‰ºö„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ê≠¥Âè≤„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="historyModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üèõÔ∏è</span> Ê≠¥Âè≤
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="historyCategories"></div>
            <div class="text-center space-y-2">
                <button id="startHistoryQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('history', 'üèõÔ∏è Ê≠¥Âè≤')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToSocial()">
                    ‚Üê Á§æ‰ºö„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- ÂÖ¨Ê∞ë„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="civicsModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">‚öñÔ∏è</span> ÂÖ¨Ê∞ë
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="civicsCategories"></div>
            <div class="text-center space-y-2">
                <button id="startCivicsQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('civics', '‚öñÔ∏è ÂÖ¨Ê∞ë')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToSocial()">
                    ‚Üê Á§æ‰ºö„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- ÂåñÂ≠¶„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="chemistryModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üß™</span> ÂåñÂ≠¶
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="chemistryCategories"></div>
            <div class="text-center space-y-2">
                <button id="startChemistryQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('chemistry', 'üß™ ÂåñÂ≠¶')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToScience()">
                    ‚Üê ÁêÜÁßë„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- ÁîüÁâ©„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="biologyModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üß¨</span> ÁîüÁâ©
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="biologyCategories"></div>
            <div class="text-center space-y-2">
                <button id="startBiologyQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('biology', 'üß¨ ÁîüÁâ©')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToScience()">
                    ‚Üê ÁêÜÁßë„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Áâ©ÁêÜ„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="physicsModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">‚öõÔ∏è</span> Áâ©ÁêÜ
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="physicsCategories"></div>
            <div class="text-center space-y-2">
                <button id="startPhysicsQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('physics', '‚öõÔ∏è Áâ©ÁêÜ')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToScience()">
                    ‚Üê ÁêÜÁßë„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Âú∞Â≠¶„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="earthModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üåç</span> Âú∞Â≠¶
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="earthCategories"></div>
            <div class="text-center space-y-2">
                <button id="startEarthQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('earth', 'üåç Âú∞Â≠¶')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToScience()">
                    ‚Üê ÁêÜÁßë„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ëã±ÂçòË™û„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="englishWordsModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üìù</span> Ëã±ÂçòË™û
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="englishWordsCategories"></div>
            <div class="text-center space-y-2">
                <button id="startEnglishWordsQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('english_words', 'üìù Ëã±ÂçòË™û')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToEnglish()">
                    ‚Üê Ëã±Ë™û„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ëã±ÁÜüË™û„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="englishPhrasesModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üí¨</span> Ëã±ÁÜüË™û
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="englishPhrasesCategories"></div>
            <div class="text-center space-y-2">
                <button id="startEnglishPhrasesQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('english_phrases', 'üí¨ Ëã±ÁÜüË™û')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToEnglish()">
                    ‚Üê Ëã±Ë™û„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ë™ûÂΩ¢Â§âÂåñ„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="englishGrammarModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700 clickable-element">
                    <span class="rotating-icon">üìò</span> Ë™ûÂΩ¢Â§âÂåñ
                </h2>
                <p class="text-gray-600 text-sm clickable-element">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="englishGrammarCategories"></div>
            <div class="text-center space-y-2">
                <button id="startEnglishGrammarQuiz" class="clean-button px-6 py-2 text-sm tap-effect clickable-element" disabled onclick="startSelectedQuiz('english_grammar', 'üìò Ë™ûÂΩ¢Â§âÂåñ')">
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect clickable-element" onclick="goBackToEnglish()">
                    ‚Üê Ëã±Ë™û„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
    <div id="gameScreen" class="hidden">
        <div class="clean-card p-6 text-center container-spacing mb-6">
            <h1 class="game-title clickable-element">
                <span class="cat-icon clickable-element" id="gameLeftCat">üê±</span>
                <span class="game-title-text">NEKOPON Quiz</span>
                <span class="cat-icon clickable-element" id="gameRightCat">üê±</span>
            </h1>
            <div id="currentCategory" class="text-lg font-semibold text-gray-700 mb-4 clickable-element"></div>
            <div class="stats-display clickable-element">
                <div class="grid grid-cols-3 gap-4 text-center mb-4">
                    <div class="clickable-element">
                        <div class="text-xl font-bold text-gray-800 clickable-element" id="correctCount">0</div>
                        <div class="text-xs text-gray-600 clickable-element">Ê≠£Ëß£Êï∞„Å†„Å´„ÇÉ‚ô™</div>
                    </div>
                    <div class="clickable-element">
                        <div class="text-xl font-bold text-gray-800 clickable-element" id="wrongCount">0</div>
                        <div class="text-xs text-gray-600 clickable-element">‰∏çÊ≠£Ëß£Êï∞„Å†„Å´„ÇÉ</div>
                    </div>
                    <div class="clickable-element">
                        <div class="text-xl font-bold text-gray-800 clickable-element" id="totalCount">0</div>
                        <div class="text-xs text-gray-600 clickable-element">Á∑èÂïèÈ°åÊï∞„Å†„Å´„ÇÉ„Äú</div>
                    </div>
                </div>
                <div class="section-divider clickable-element"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3 clickable-element"><span class="rotating-icon">üìã</span> Âá∫È°åÂΩ¢Âºè„Å†„Å´„ÇÉ„Äú</div>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="randomModeBtn" class="mode-btn active tap-effect clickable-element" data-mode="random" onclick="setQuestionMode('random')">
                            <span class="mode-icon">üé≤</span> „É©„É≥„ÉÄ„É†„Å´„ÇÉ
                        </button>
                        <button id="sequentialModeBtn" class="mode-btn tap-effect clickable-element" data-mode="sequential" onclick="setQuestionMode('sequential')">
                            <span class="mode-icon">üìã</span> È†ÜÁï™ÈÄö„Çä„Å´„ÇÉ
                        </button>
                    </div>
                    <div class="text-xs text-gray-600 mt-2 clickable-element" id="modeDescription">
                        ÂïèÈ°å„Çí„É©„É≥„ÉÄ„É†„Å´Âá∫È°å„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                    </div>
                </div>
            </div>
            <button id="startQuizButton" class="clean-button px-6 py-3 text-base font-semibold mt-6 tap-effect clickable-element" onclick="openQuiz()">
                <span class="rotating-icon">‚ú®</span> „Çπ„Çø„Éº„Éà„Å´„ÇÉ„Äú‚ô™
            </button>
        </div>
    </div>

    <!-- „ÇØ„Ç§„Ç∫„É¢„Éº„ÉÄ„É´ -->
    <div id="quizModal" class="modal">
        <div class="clean-card p-4 w-full max-w-lg mx-4">
            <div class="text-center mb-4">
                <h2 class="font-semibold text-lg text-gray-700 clickable-element">
                    <span class="rotating-icon">üê±</span> NEKOPON Quiz <span class="rotating-icon">üê±</span>
                </h2>
            </div>
            <div class="space-y-4">
                <p id="quizQ" class="text-base font-medium text-center text-gray-800 leading-relaxed clickable-element"></p>
                <div id="quizOptions" class="space-y-2"></div>
                <div id="quizExplanation" class="quiz-explanation clickable-element">
                    <p id="quizMsg" class="font-semibold text-center text-base clickable-element"></p>
                </div>
                <div class="flex gap-2">
                    <button id="quizNext" class="flex-1 clean-button py-2 text-sm tap-effect clickable-element" onclick="loadNextQuiz()">
                        <span class="rotating-icon">üåü</span> Ê¨°„ÅÆÂïèÈ°å„Å´„ÇÉ„Äú
                    </button>
                    <button id="quizBack" class="flex-1 back-button py-2 text-sm tap-effect clickable-element" onclick="closeQuiz()">
                        <span class="rotating-icon">üè†</span> Êàª„Çã„Å´„ÇÉ„Äú
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Èü≥Â£∞Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´ -->
    <div id="voiceSettingsModal" class="modal">
        <div class="clean-card voice-modal-content">
            <div class="voice-modal-padding">
                <div class="text-center mb-6">
                    <h2 class="text-lg font-semibold text-gray-700 clickable-element">
                        <span class="rotating-icon">üéµ</span> Èü≥Â£∞Ë®≠ÂÆö„Å´„ÇÉ„Äú <span class="rotating-icon">üéµ</span>
                    </h2>
                    <p class="text-gray-600 text-xs mt-1 clickable-element">Ëã±Ë™û„ÅÆÁô∫Èü≥Ê©üËÉΩ„ÇíË®≠ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™</p>
                </div>

                <!-- Èü≥Â£∞ON/OFFÂàá„ÇäÊõø„Åà -->
                <div class="voice-switch">
                    <div class="clickable-element">
                        <div class="text-sm font-semibold text-gray-700 mb-1">
                            <span class="rotating-icon">üîä</span> Èü≥Â£∞Ë™≠„Åø‰∏ä„Åí
                        </div>
                        <div class="text-xs text-gray-600">Ëã±Ë™û„ÅÆÂïèÈ°å„Å®ÈÅ∏ÊäûËÇ¢„ÇíÈü≥Â£∞„ÅßË™≠„Åø‰∏ä„Åí„Çã„Å´„ÇÉ„Äú</div>
                    </div>
                    <div class="switch-container">
                        <input type="checkbox" id="voiceToggle" class="switch-input" checked>
                        <span class="switch-slider"></span>
                    </div>
                </div>

                <!-- Â•≥ÊÄßÈü≥Â£∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="voice-section">
                    <h3><span class="rotating-icon">üë©</span> Â•≥ÊÄßÈü≥Â£∞„Å†„Å´„ÇÉ„Äú‚ô™</h3>
                    <div class="voice-option clickable-element" data-voice="samantha">
                        <div class="voice-info">
                            <div class="voice-name">Samantha</div>
                            <div class="voice-description">Ëá™ÁÑ∂„ÅßËÅû„ÅçÂèñ„Çä„ÇÑ„Åô„ÅÑÂ•≥ÊÄß„ÅÆÂ£∞„Å´„ÇÉ„Äú‚ô™</div>
                        </div>
                        <div class="voice-controls">
                            <button class="voice-test-btn" onclick="testVoice('samantha')">Ë©¶ËÅ¥„Å´„ÇÉ„Äú</button>
                        </div>
                    </div>
                </div>

                <!-- Áî∑ÊÄßÈü≥Â£∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="voice-section">
                    <h3><span class="rotating-icon">üë®</span> Áî∑ÊÄßÈü≥Â£∞„Å†„Å´„ÇÉ„Äú‚ô™</h3>
                    <div class="voice-option clickable-element" data-voice="alex">
                        <div class="voice-info">
                            <div class="voice-name">Alex</div>
                            <div class="voice-description">Ê®ôÊ∫ñÁöÑ„ÅßËÅû„ÅçÂèñ„Çä„ÇÑ„Åô„ÅÑÁî∑ÊÄß„ÅÆÂ£∞„Å´„ÇÉ„Äú‚ô™</div>
                        </div>
                        <div class="voice-controls">
                            <button class="voice-test-btn" onclick="testVoice('alex')">Ë©¶ËÅ¥„Å´„ÇÉ„Äú</button>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-6">
                    <button class="clean-button px-4 py-2 text-sm tap-effect clickable-element" onclick="closeVoiceSettings()">
                        <span class="rotating-icon">‚ú®</span> Ë®≠ÂÆöÂÆå‰∫Ü„Å´„ÇÉ„Äú‚ô™
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éú„Çø„É≥ÔºàÊïôÁßëÂ§âÊõ¥Ôºâ -->
    <button id="changeSubject" class="floating-button hidden tap-effect clickable-element" onclick="changeSubject()">
        <span class="floating-button-icon">üìö</span>
    </button>

    <!-- Èü≥Â£∞Ë®≠ÂÆö„Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éú„Çø„É≥ -->
    <button id="voiceSettingsButton" class="voice-floating-button tap-effect clickable-element" onclick="openVoiceSettings()">
        <span class="floating-button-icon">üéµ</span>
    </button>

    <!-- ÈÄöÁü• -->
    <div id="notification" class="notification">
        <div class="flex items-center gap-3">
            <span class="text-xl rotating-icon">‚ú®</span>
            <div>
                <div class="font-semibold text-sm">üê± NEKOPON Quiz üê±</div>
                <div id="notificationText" class="text-xs text-gray-600"></div>
            </div>
        </div>
    </div>

    <!-- ÈáçÂäõÊÑüÁü•„ÅÆÊ®©ÈôêË¶ÅÊ±Ç„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó -->
    <div id="tiltPermissionPopup" class="permission-popup">
        <h3><span class="rotating-icon">üê±</span> Áå´ÂèçÂøúÊ©üËÉΩ <span class="rotating-icon">üê±</span></h3>
        <p>„Çπ„Éû„Éõ„ÇíÂÇæ„Åë„Çã„Å®Áå´„Åå„ÇØ„É´„ÇØ„É´ÂõûËª¢„Åó„Åæ„Åô‚ô™<br>ÂãâÂº∑„Åå„ÇÇ„Å£„Å®Ê•Ω„Åó„Åè„Å™„Çã„Å´„ÇÉ„Äú</p>
        <button onclick="requestTiltPermission()">ÊúâÂäπ„Å´„Åô„Çã</button>
        <button onclick="skipTiltPermission()">„Çπ„Ç≠„ÉÉ„Éó</button>
    </div>

    <script>
        /* ----------------- „ÉÄ„Éü„ÉºÂïèÈ°å„Éá„Éº„Çø„Éô„Éº„ÇπÔºàproblems.js‰ª£ÊõøÔºâ ----------------- */
        const problemDatabase = {
            // Âú∞ÁêÜ
            geo_world_overview: [
                {
                    q: "Âú∞ÁêÉ„ÅÆÁõ¥ÂæÑ„ÅØÁ¥Ñ‰Ωïkm„Åß„Åô„ÅãÔºü",
                    opts: ["Á¥Ñ8,000km", "Á¥Ñ12,800km", "Á¥Ñ16,000km", "Á¥Ñ20,000km"],
                    ans: 1,
                    exp: "Âú∞ÁêÉ„ÅÆÁõ¥ÂæÑ„ÅØÁ¥Ñ12,800km„Åß„Åô„ÄÇ"
                },
                {
                    q: "Ëµ§ÈÅì„ÅÆÈï∑„Åï„ÅØÁ¥Ñ‰Ωïkm„Åß„Åô„ÅãÔºü",
                    opts: ["Á¥Ñ30,000km", "Á¥Ñ40,000km", "Á¥Ñ50,000km", "Á¥Ñ60,000km"],
                    ans: 1,
                    exp: "Ëµ§ÈÅì„ÅÆÈï∑„Åï„ÅØÁ¥Ñ40,000km„Åß„Åô„ÄÇ"
                },
                {
                    q: "‰∏ñÁïå„ÅßÊúÄ„ÇÇÈ´ò„ÅÑÂ±±„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                    opts: ["ÂØåÂ£´Â±±", "„Ç®„Éô„É¨„Çπ„Éà", "„Ç≠„É™„Éû„É≥„Ç∏„É£„É≠", "„Éû„ÉÉ„Ç≠„É≥„É™„Éº"],
                    ans: 1,
                    exp: "„Ç®„Éô„É¨„Çπ„Éà„ÅØÊ®ôÈ´ò8,848m„Åß‰∏ñÁïåÊúÄÈ´òÂ≥∞„Åß„Åô„ÄÇ"
                }
            ],
            geo_japan_overview: [
                {
                    q: "Êó•Êú¨„ÅÆÊúÄÈ´òÂ≥∞„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                    opts: ["ÂØåÂ£´Â±±", "ÂåóÂ≤≥", "Â••Á©ÇÈ´òÂ≤≥", "Èñì„ÉéÂ≤≥"],
                    ans: 0,
                    exp: "ÂØåÂ£´Â±±„ÅØÊ®ôÈ´ò3,776m„ÅßÊó•Êú¨ÊúÄÈ´òÂ≥∞„Åß„Åô„ÄÇ"
                }
            ],
            
            // Ê≠¥Âè≤
            hist_ancient: [
                {
                    q: "ÊúÄÂàù„ÅÆÊñáÊòé„ÅåËµ∑„Åì„Å£„ÅüÂ†¥ÊâÄ„Å®„Åó„Å¶Ê≠£„Åó„ÅÑ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                    opts: ["„Ç®„Ç∏„Éó„Éà", "„É°„ÇΩ„Éù„Çø„Éü„Ç¢", "„Ç§„É≥„ÉÄ„ÇπÂ∑ùÊµÅÂüü", "„Åô„Åπ„Å¶Ê≠£„Åó„ÅÑ"],
                    ans: 3,
                    exp: "Âè§‰ª£ÂõõÂ§ßÊñáÊòé„ÅØ„Åô„Åπ„Å¶Â§ßÊ≤≥„ÅÆ„Åù„Å∞„ÅßÁô∫ÈÅî„Åó„Åæ„Åó„Åü„ÄÇ"
                },
                {
                    q: "Á∏ÑÊñáÊôÇ‰ª£„ÅÆÁâπÂæ¥„Å®„Åó„Å¶Ê≠£„Åó„ÅÑ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                    opts: ["Ëæ≤Ê•≠„ÅåÂßã„Åæ„Å£„Åü", "ÂúüÂô®„Çí‰ΩøÁî®„Åó„Åü", "ÈáëÂ±ûÂô®„Çí‰ΩøÁî®„Åó„Åü", "ÊñáÂ≠ó„Åå‰Ωø„Çè„Çå„Åü"],
                    ans: 1,
                    exp: "Á∏ÑÊñáÊôÇ‰ª£„ÅØÁ∏ÑÊñáÂúüÂô®„ÅåÁâπÂæ¥ÁöÑ„Å™ÊôÇ‰ª£„Åß„Åô„ÄÇ"
                }
            ],
            
            // ÂÖ¨Ê∞ë
            civics_modern: [
                {
                    q: "Êó•Êú¨ÂõΩÊÜ≤Ê≥ï„ÅåÊñΩË°å„Åï„Çå„Åü„ÅÆ„ÅØ„ÅÑ„Å§„Åß„Åô„ÅãÔºü",
                    opts: ["1946Âπ¥", "1947Âπ¥", "1948Âπ¥", "1949Âπ¥"],
                    ans: 1,
                    exp: "Êó•Êú¨ÂõΩÊÜ≤Ê≥ï„ÅØ1947Âπ¥5Êúà3Êó•„Å´ÊñΩË°å„Åï„Çå„Åæ„Åó„Åü„ÄÇ"
                },
                {
                    q: "Êó•Êú¨ÂõΩÊÜ≤Ê≥ï„ÅÆ‰∏âÂ§ßÂéüÂâá„Å´Âê´„Åæ„Çå„Å™„ÅÑ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                    opts: ["ÂõΩÊ∞ë‰∏ªÊ®©", "Âü∫Êú¨ÁöÑ‰∫∫Ê®©„ÅÆÂ∞äÈáç", "Âπ≥Âíå‰∏ªÁæ©", "ÊîøÊïôÂàÜÈõ¢"],
                    ans: 3,
                    exp: "‰∏âÂ§ßÂéüÂâá„ÅØÂõΩÊ∞ë‰∏ªÊ®©„ÄÅÂü∫Êú¨ÁöÑ‰∫∫Ê®©„ÅÆÂ∞äÈáç„ÄÅÂπ≥Âíå‰∏ªÁæ©„Åß„Åô„ÄÇ"
                }
            ],
            
            // ÂåñÂ≠¶
            chemistry_basic: [
                {
                    q: "Ê∞¥„ÅÆÂåñÂ≠¶Âºè„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                    opts: ["H2O", "H2O2", "HO", "H3O"],
                    ans: 0,
                    exp: "Ê∞¥„ÅÆÂåñÂ≠¶Âºè„ÅØH2O„Åß„Åô„ÄÇ"
                },
                {
                    q: "ÈÖ∏Á¥†„ÅÆÂåñÂ≠¶Âºè„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                    opts: ["O", "O2", "O3", "OH"],
                    ans: 1,
                    exp: "ÈÖ∏Á¥†„ÅÆÂåñÂ≠¶Âºè„ÅØO2„Åß„Åô„ÄÇ"
                }
            ],
            
            // ÁîüÁâ©
            biology_flower: [
                {
                    q: "Ëä±„ÅÆÈõÑ„Åó„Åπ„ÅÆÂÖàÁ´ØÈÉ®ÂàÜ„Çí‰Ωï„Å®Âëº„Å≥„Åæ„Åô„ÅãÔºü",
                    opts: ["Ëä±Á≤â", "„ÇÑ„Åè", "Ëä±Á≥∏", "ËÉöÁè†"],
                    ans: 1,
                    exp: "ÈõÑ„Åó„Åπ„ÅÆÂÖàÁ´ØÈÉ®ÂàÜ„ÅØ„Äå„ÇÑ„Åè„Äç„Å®Âëº„Å∞„Çå„ÄÅËä±Á≤â„Åå‰Ωú„Çâ„Çå„Åæ„Åô„ÄÇ"
                }
            ],
            
            // Áâ©ÁêÜ
            physics_light: [
                {
                    q: "ÂÖâ„ÅåÊ∞¥‰∏≠„Åã„ÇâÁ©∫Ê∞ó‰∏≠„Å´ÈÄ≤„ÇÄ„Å®„Åç„ÄÅ„Å©„ÅÆ„Çà„ÅÜ„Å™ÁèæË±°„ÅåËµ∑„Åì„Çä„Åæ„Åô„ÅãÔºü",
                    opts: ["Â±àÊäò", "ÂèçÂ∞Ñ", "ÂàÜÊï£", "„Åô„Åπ„Å¶"],
                    ans: 3,
                    exp: "ÂÖâ„ÅØÂ±àÊäò„ÄÅÂèçÂ∞Ñ„ÄÅÂàÜÊï£„ÅÆ„Åô„Åπ„Å¶„ÅÆÁèæË±°„ÇíËµ∑„Åì„Åó„Åæ„Åô„ÄÇ"
                }
            ],
            
            // Âú∞Â≠¶
            earth_volcano: [
                {
                    q: "ÁÅ´Â±±„ÅÆÂô¥Âá∫Áâ©„Åß„Å™„ÅÑ„ÇÇ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                    opts: ["Ê∫∂Â≤©", "ÁÅ´Â±±ÁÅ∞", "ÁÅ´Â±±„Ç¨„Çπ", "Âú∞Èúá"],
                    ans: 3,
                    exp: "Âú∞Èúá„ÅØÁÅ´Â±±„ÅÆÂô¥Âá∫Áâ©„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ"
                }
            ],
            
            // Ëã±ÂçòË™û
            words_time: [
                {
                    q: "„ÄåJanuary„Äç„ÅÆÊÑèÂë≥„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                    opts: ["12Êúà", "1Êúà", "2Êúà", "11Êúà"],
                    ans: 1,
                    exp: "January„ÅØ1Êúà„Å®„ÅÑ„ÅÜÊÑèÂë≥„Åß„Åô„ÄÇ"
                },
                {
                    q: "„ÄåMonday„Äç„ÅÆÊÑèÂë≥„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                    opts: ["Êó•ÊõúÊó•", "ÊúàÊõúÊó•", "ÁÅ´ÊõúÊó•", "Ê∞¥ÊõúÊó•"],
                    ans: 1,
                    exp: "Monday„ÅØÊúàÊõúÊó•„Å®„ÅÑ„ÅÜÊÑèÂë≥„Åß„Åô„ÄÇ"
                }
            ],
            
            // Ëã±ÁÜüË™û
            phrases_verb: [
                {
                    q: "„Äålook for„Äç„ÅÆÊÑèÂë≥„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                    opts: ["Ë¶ã„Çã", "Êé¢„Åô", "Ë¶ã‰∏ä„Åí„Çã", "Ë¶ã‰∏ã„Çç„Åô"],
                    ans: 1,
                    exp: "look for„ÅØ„ÄåÊé¢„Åô„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Åß„Åô„ÄÇ"
                }
            ],
            
            // Ë™ûÂΩ¢Â§âÂåñ
            grammar_irregular_past: [
                {
                    q: "„Äågo„Äç„ÅÆÈÅéÂéªÂΩ¢„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                    opts: ["goed", "went", "gone", "going"],
                    ans: 1,
                    exp: "go„ÅÆÈÅéÂéªÂΩ¢„ÅØwent„Åß„Åô„ÄÇ"
                }
            ]
        };

        /* ----------------- Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†ÔºàÁ∞°Áï•ÁâàÔºâ ----------------- */
        class SimpleVoiceSystem {
            constructor() {
                this.voiceEnabled = true;
                this.selectedVoice = 'samantha';
                this.availableVoices = [];
                this.init();
            }

            init() {
                this.loadSettings();
                this.initVoices();
                this.updateUI();

                document.getElementById('voiceToggle').addEventListener('change', (e) => {
                    this.voiceEnabled = e.target.checked;
                    this.saveSettings();
                    showNotification(this.voiceEnabled ? 'Èü≥Â£∞„ÇíON„Å´„Åó„Åü„Å´„ÇÉ„Äú‚ô™' : 'Èü≥Â£∞„ÇíOFF„Å´„Åó„Åü„Å´„ÇÉ„Äú');
                });

                document.querySelectorAll('.voice-option').forEach(option => {
                    option.addEventListener('click', () => {
                        this.selectVoice(option.dataset.voice);
                    });
                });
            }

            initVoices() {
                if (!('speechSynthesis' in window)) {
                    showNotification('„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞Ê©üËÉΩ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Å™„ÅÑ„Å´„ÇÉ„Äú');
                    return;
                }

                const loadVoices = () => {
                    this.availableVoices = speechSynthesis.getVoices();
                    this.updateUI();
                };

                speechSynthesis.addEventListener('voiceschanged', loadVoices);
                loadVoices();
            }

            selectVoice(voiceId) {
                this.selectedVoice = voiceId;
                this.saveSettings();
                this.updateUI();
                const voiceName = voiceId;
                showNotification(`${voiceName}„ÇíÈÅ∏Êäû„Åó„Åü„Å´„ÇÉ„Äú‚ô™`);
                soundSystem.playSuccess();
            }

            updateUI() {
                document.getElementById('voiceToggle').checked = this.voiceEnabled;

                document.querySelectorAll('.voice-option').forEach(option => {
                    option.classList.remove('selected');
                });

                const selectedOption = document.querySelector(`[data-voice="${this.selectedVoice}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }

            speak(text) {
                if (!this.voiceEnabled || !text || !('speechSynthesis' in window)) {
                    return;
                }

                try {
                    speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.85;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    speechSynthesis.speak(utterance);
                } catch (error) {
                    console.log('Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº:', error);
                }
            }

            testVoice(voiceId) {
                const testText = "Hello! This is a test of the English pronunciation feature. Welcome to NEKOPON Quiz!";
                this.speak(testText);
                soundSystem.playClick();
                const voiceName = voiceId;
                showNotification(`${voiceName}„ÅÆÈü≥Â£∞„Çí„ÉÜ„Çπ„Éà‰∏≠„Å´„ÇÉ„Äú‚ô™`);
            }

            saveSettings() {
                try {
                    const settings = {
                        voiceEnabled: this.voiceEnabled,
                        selectedVoice: this.selectedVoice
                    };
                    localStorage.setItem('nekoponVoiceSettings', JSON.stringify(settings));
                } catch (error) {
                    console.log('Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:', error);
                }
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('nekoponVoiceSettings');
                    if (saved) {
                        const settings = JSON.parse(saved);
                        this.voiceEnabled = settings.voiceEnabled !== undefined ? settings.voiceEnabled : true;
                        this.selectedVoice = settings.selectedVoice || 'samantha';
                    }
                } catch (error) {
                    console.log('Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', error);
                }
            }
        }

        /* ----------------- ÈáçÂäõÊÑüÁü•„Ç∑„Çπ„ÉÜ„É†ÔºàÁ∞°Áï•ÁâàÔºâ ----------------- */
        class SimpleTiltSystem {
            constructor() {
                this.tiltEnabled = false;
                this.currentTilt = { gamma: 0, beta: 0 };
                this.lastTiltTime = 0;
                this.permissionPopup = null;
                this.isMainPageDisplayed = false;
            }

            init() {
                this.waitForMainPage();
            }

            waitForMainPage() {
                const checkMainPage = () => {
                    const mainModal = document.getElementById('mainSubjectModal');
                    if (mainModal && mainModal.classList.contains('show')) {
                        this.isMainPageDisplayed = true;
                        setTimeout(() => {
                            this.showTiltPermissionPopup();
                        }, 2000);
                    } else {
                        setTimeout(checkMainPage, 200);
                    }
                };
                checkMainPage();
            }

            showTiltPermissionPopup() {
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    const popup = document.getElementById('tiltPermissionPopup');
                    popup.classList.add('show');
                    this.permissionPopup = popup;
                } else {
                    this.enableTiltSensor();
                }
            }

            async requestTiltPermission() {
                try {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    if (permission === 'granted') {
                        this.enableTiltSensor();
                        showNotification('ÈáçÂäõÊÑüÁü•Ê©üËÉΩ„ÅåÊúâÂäπ„Å´„Å™„Å£„Åü„Å´„ÇÉ„Äú‚ô™');
                    } else {
                        showNotification('ÈáçÂäõÊÑüÁü•„ÅØÁÑ°Âäπ„Åß„Åô„Åå„ÄÅÊ•Ω„Åó„ÅèÂ≠¶Áøí„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™');
                    }
                } catch (error) {
                    console.log('Permission denied or error occurred');
                    showNotification('ÈáçÂäõÊÑüÁü•„ÅØÁÑ°Âäπ„Åß„Åô„Åå„ÄÅÊ•Ω„Åó„ÅèÂ≠¶Áøí„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™');
                }
                this.closeTiltPermissionPopup();
            }

            skipTiltPermission() {
                this.closeTiltPermissionPopup();
                showNotification('ÈáçÂäõÊÑüÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åó„Åü„ÄÇÊ•Ω„Åó„ÅèÂ≠¶Áøí„Å´„ÇÉ„Äú‚ô™');
            }

            closeTiltPermissionPopup() {
                if (this.permissionPopup) {
                    this.permissionPopup.classList.remove('show');
                    this.permissionPopup = null;
                }
            }

            enableTiltSensor() {
                this.tiltEnabled = true;

                window.addEventListener('deviceorientation', (event) => {
                    if (!this.tiltEnabled) return;
                    this.currentTilt.gamma = event.gamma || 0;
                    this.currentTilt.beta = event.beta || 0;
                    this.updateAllIconOrientations();
                });

                if (!window.DeviceOrientationEvent || navigator.userAgent.includes('Chrome')) {
                    this.startTestRotation();
                }
            }

            startTestRotation() {
                setInterval(() => {
                    if (!this.tiltEnabled) return;

                    const time = Date.now() * 0.001;
                    this.currentTilt.gamma = Math.sin(time * 0.8) * 45 + Math.sin(time * 2.3) * 15;
                    this.currentTilt.beta = Math.cos(time * 0.6) * 30 + Math.cos(time * 1.7) * 10;

                    this.updateAllIconOrientations();
                }, 50);
            }

            updateAllIconOrientations() {
                const now = Date.now();
                if (now - this.lastTiltTime < 30) return;
                this.lastTiltTime = now;

                const gamma = this.currentTilt.gamma;
                const beta = this.currentTilt.beta;

                let baseRotation = gamma * 1.5;
                if (Math.abs(beta) > 60) {
                    baseRotation += beta * 0.3;
                }

                const iconSelectors = [
                    '.rotating-icon',
                    '.cat-icon',
                    '.subject-icon',
                    '.category-icon',
                    '.mode-icon',
                    '.floating-button-icon'
                ];

                iconSelectors.forEach(selector => {
                    document.querySelectorAll(selector).forEach((element, index) => {
                        this.applyRotationToElement(element, baseRotation, index);
                    });
                });
            }

            applyRotationToElement(element, baseRotation, index) {
                if (this.shouldSkipElement(element)) {
                    return;
                }

                const individualRotation = baseRotation + (index % 12 - 6) * 8 + Math.sin(Date.now() * 0.001 + index) * 5;
                element.style.setProperty('--rotation', `${individualRotation}deg`);

                if (element.classList.contains('cat-icon') && !element.classList.contains('bounce')) {
                    element.style.transform = `rotate(${individualRotation}deg)`;
                } else if (!element.classList.contains('cat-icon')) {
                    element.style.transform = `rotate(${individualRotation}deg)`;
                }
            }

            shouldSkipElement(element) {
                return element.classList.contains('bounce') ||
                       element.classList.contains('animating') ||
                       element.closest('.tap-sparkle') ||
                       element.closest('.tap-fire') ||
                       element.closest('.tap-trophy') ||
                       element.closest('.cute-shake-effect') ||
                       element.closest('.title-bounce') ||
                       element.closest('.score-pulse') ||
                       element.closest('.tapped');
            }
        }

        /* ----------------- „Éù„Ç§„É≥„Éà„Ç∑„Çπ„ÉÜ„É†ÔºàÁ∞°Áï•ÁâàÔºâ ----------------- */
        class SimplePointSystem {
            constructor() {
                this.sparklePoints = 0;
                this.firePoints = 0;
                this.trophyPoints = 0;
                this.totalClicks = 0;
                this.comboCount = 0;
                this.lastClickTime = 0;
                this.multiplier = 1;
                this.isComboMode = false;

                this.sparkleMessages = [
                    '„Åç„ÇÉ„Éº‚ô™', '„Åç„Çâ„Åç„Çâ„Äú', '„Åæ„Å∂„Åó„ÅÑÔºÅ', '„Åô„Å¶„Åç‚ô™', '„Å¥„Åã„Å¥„Åã„Äú'
                ];

                this.fireMessages = [
                    '„ÅÇ„Å§„ÅÇ„Å§„Äú', '„ÇÅ„Çâ„ÇÅ„ÇâÔºÅ', '„ÇÇ„Åà„ÇÇ„Åà„Äú', '„ÅΩ„Åã„ÅΩ„Åã‚ô™', '„ÅØ„Éº„Å®‚ô™'
                ];

                this.trophyMessages = [
                    '„Åô„Åî„ÅÑ„Å≠ÔºÅ', '„Åà„Çâ„ÅÑ„Åà„Çâ„ÅÑ‚ô™', '„ÇÑ„Å£„Åü„ÉºÔºÅ', '„Åå„Çì„Å∞„Å£„ÅüÔºÅ', 'ÊúÄÈ´ò„Å†„Å≠‚ô™'
                ];

                this.initializeSystem();
            }

            initializeSystem() {
                this.addGlobalClickListeners();
                this.initPointBubbles();
                setInterval(() => this.checkComboTimeout(), 100);
                setInterval(() => this.autoBonus(), 5000);
            }

            addGlobalClickListeners() {
                document.addEventListener('click', (e) => {
                    const element = e.target;
                    if (element.classList.contains('clickable-element') || element.closest('.clickable-element')) {
                        this.handleElementClick(e);
                    }
                });
            }

            initPointBubbles() {
                document.getElementById('sparklePointBubble').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.megaTapPointBubble('sparkle', e);
                });

                document.getElementById('firePointBubble').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.megaTapPointBubble('fire', e);
                });

                document.getElementById('trophyPointBubble').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.megaTapPointBubble('trophy', e);
                });
            }

            handleElementClick(e) {
                const element = e.target.closest('.clickable-element') || e.target;

                const now = Date.now();
                if (now - this.lastClickTime < 500) {
                    this.comboCount++;
                    this.multiplier = Math.min(5, 1 + (this.comboCount * 0.1));
                    this.isComboMode = true;
                } else {
                    this.comboCount = 0;
                    this.multiplier = 1;
                    this.isComboMode = false;
                }

                this.lastClickTime = now;

                let basePoints = 5;
                let particleType = 'normal';
                let messages = ['„ÅΩ„Å°„Å£‚ô™', '„Åü„Å£„Å°„Äú', '„Å∫„Å°„Å∫„Å°‚ô™'];

                if (element.classList.contains('game-title') || element.id === 'gameTitle') {
                    basePoints = 50;
                    particleType = 'mega';
                    messages = ['„Åü„ÅÑ„Å®„Çã„Äú‚ô™', 'NEKOPON‚ô™', '„Çç„Åî„ÄúÔºÅ'];
                } else if (element.classList.contains('cat-icon')) {
                    basePoints = 25;
                    particleType = 'bonus';
                    messages = ['„Å´„ÇÉ„Éº„Çì‚ô™', '„Å≠„Åì„Å°„ÇÉ„Çì‚ô™', '„Åã„Çè„ÅÑ„ÅÑ„Äú'];
                } else if (element.classList.contains('subject-btn') || element.classList.contains('category-btn')) {
                    basePoints = 15;
                    particleType = 'bonus';
                    messages = ['„Åº„Åü„Çì‚ô™', '„Åõ„Çì„Åü„Åè„Äú', '„Åè„Çä„Å£„ÅèÔºÅ'];
                } else if (element.classList.contains('clean-button') || element.classList.contains('quiz-option')) {
                    basePoints = 12;
                    particleType = 'bonus';
                    messages = ['„Åü„Å£„Å∑‚ô™', '„ÅΩ„Å°„Å£„Å®„Äú', '„Åê„Å£„Å©ÔºÅ'];
                }

                const finalPoints = Math.floor(basePoints * this.multiplier);

                const distribution = Math.random();
                if (distribution < 0.4) {
                    this.sparklePoints += finalPoints;
                } else if (distribution < 0.7) {
                    this.firePoints += Math.floor(finalPoints * 0.7);
                } else {
                    this.trophyPoints += Math.floor(finalPoints * 1.5);
                }

                this.totalClicks++;

                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                element.classList.add('cute-shake-effect');
                setTimeout(() => element.classList.remove('cute-shake-effect'), 600);

                this.createCuteParticles(centerX, centerY, ['‚ú®', 'üí´', 'üåü', 'üíñ', 'üéä', '‚≠ê', 'üíé'], this.isComboMode ? 8 : 4);

                this.showFloatingPoints(finalPoints, centerX, centerY, this.isComboMode ? 'ultra' : particleType);

                const message = this.isComboMode ? `„Ç≥„É≥„Éú√ó${this.multiplier.toFixed(1)}` : messages[Math.floor(Math.random() * messages.length)];
                showNekoMsg(message, centerX, centerY);

                soundSystem.playSound(this.isComboMode ? 'mega' : 'sparkle');
                soundSystem.vibrate(this.isComboMode ? [80, 40, 80, 40, 120] : [50]);

                this.updateAllPointDisplays();
            }

            megaTapPointBubble(type, event) {
                let bonusPoints, messages, particles, soundType;

                switch(type) {
                    case 'sparkle':
                        bonusPoints = 200;
                        messages = this.sparkleMessages;
                        particles = ['‚ú®', 'üí´', 'üåü', 'üíé', '‚≠ê', 'üîÆ'];
                        soundType = 'sparkle';
                        this.sparklePoints += bonusPoints;
                        break;
                    case 'fire':
                        bonusPoints = 150;
                        messages = this.fireMessages;
                        particles = ['üî•', 'üíï', '‚ù§Ô∏è', 'üíñ', 'üíù', 'üíò'];
                        soundType = 'fire';
                        this.firePoints += bonusPoints;
                        break;
                    case 'trophy':
                        bonusPoints = 300;
                        messages = this.trophyMessages;
                        particles = ['üèÜ', 'üëë', 'üéä', 'üéâ', 'üåü', 'üí´', 'üéÜ', 'üéñÔ∏è'];
                        soundType = 'trophy';
                        this.trophyPoints += bonusPoints;
                        break;
                }

                this.totalClicks++;

                soundSystem.playSound(soundType);
                soundSystem.vibrate([200, 100, 200, 100, 300]);

                const element = event.target;
                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                element.classList.add(`tap-${type}`);
                setTimeout(() => element.classList.remove(`tap-${type}`), 800);

                this.createCuteParticles(centerX, centerY, particles, 10);

                this.showFloatingPoints(bonusPoints, centerX, centerY, 'ultra');

                const message = messages[Math.floor(Math.random() * messages.length)];
                showNekoMsg(message, centerX, centerY);

                this.updateAllPointDisplays();
            }

            checkComboTimeout() {
                const now = Date.now();
                if (this.isComboMode && now - this.lastClickTime > 1000) {
                    this.comboCount = 0;
                    this.multiplier = 1;
                    this.isComboMode = false;
                }
            }

            autoBonus() {
                if (this.totalClicks > 0) {
                    const bonus = Math.floor(this.totalClicks * 0.05);
                    this.sparklePoints += bonus;
                    this.firePoints += bonus;
                    this.trophyPoints += bonus;

                    const messages = ['„Åä„Åæ„Åë„Å´„ÇÉ„Äú', '„Åº„Éº„Å™„Åô‚ô™', '„Åï„Éº„Å≥„Åô„Äú'];
                    showNekoMsg(messages[Math.floor(Math.random() * messages.length)], window.innerWidth - 100, 100);

                    this.updateAllPointDisplays();
                }
            }

            createCuteParticles(x, y, emojis, count) {
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.className = 'cute-particle';
                        particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                        particle.style.left = (x + (Math.random() - 0.5) * 60) + 'px';
                        particle.style.top = (y + (Math.random() - 0.5) * 60) + 'px';
                        particle.style.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
                        document.body.appendChild(particle);

                        setTimeout(() => particle.remove(), 1500);
                    }, i * 40);
                }
            }

            showFloatingPoints(points, x, y, type = 'normal') {
                const element = document.createElement('div');
                element.className = `floating-points ${type}`;
                element.textContent = `+${this.formatNum(points)}`;
                element.style.left = Math.min(x, window.innerWidth - 80) + 'px';
                element.style.top = Math.min(y, window.innerHeight - 40) + 'px';
                document.body.appendChild(element);

                setTimeout(() => element.remove(), 2000);
            }

            updateAllPointDisplays() {
                document.getElementById('sparklePointsMain').textContent = this.formatNum(this.sparklePoints);
                document.getElementById('firePointsMain').textContent = this.formatNum(this.firePoints);
                document.getElementById('trophyPointsMain').textContent = this.formatNum(this.trophyPoints);
            }

            formatNum(n) {
                if (n >= 1e12) return Math.floor(n / 1e12) + 'T';
                if (n >= 1e9) return Math.floor(n / 1e9) + 'B';
                if (n >= 1e6) return Math.floor(n / 1e6) + 'M';
                if (n >= 1e3) return Math.floor(n / 1e3) + 'K';
                return Math.floor(n).toString();
            }

            getTotalPoints() {
                return this.sparklePoints + this.firePoints + this.trophyPoints;
            }
        }

        /* ----------------- Èü≥Èüø„Ç∑„Çπ„ÉÜ„É†ÔºàÁ∞°Áï•ÁâàÔºâ ----------------- */
        class SimpleSoundSystem {
            constructor() {
                this.audioContext = null;
                this.sounds = {};
                this.initAudio();
            }

            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†„ÇíÂàùÊúüÂåñ„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
                }
            }

            playClick() {
                console.log('„ÇØ„É™„ÉÉ„ÇØÈü≥');
                this.vibrate([50]);
            }

            playCorrect() {
                console.log('Ê≠£Ëß£Èü≥');
                this.vibrate([100, 50, 100, 50, 150]);
            }

            playWrong() {
                console.log('‰∏çÊ≠£Ëß£Èü≥');
                this.vibrate([80, 40, 80]);
            }

            playSuccess() {
                console.log('ÊàêÂäüÈü≥');
                this.vibrate([100, 50, 100]);
            }

            playSound(type) {
                console.log(`${type}Èü≥`);
                const patterns = {
                    'sparkle': [50, 30, 50],
                    'fire': [80, 50, 80],
                    'trophy': [120, 80, 120],
                    'mega': [100, 50, 100, 50, 150]
                };
                this.vibrate(patterns[type] || [50]);
            }

            vibrate(pattern) {
                if ('vibrate' in navigator) {
                    navigator.vibrate(pattern);
                }
            }
        }

        /* ----------------- „Ç´„ÉÜ„Ç¥„É™„ÉºÂÆöÁæ© ----------------- */
        const categories = {
            geography: [
                {id: 'geo_world_overview', name: '1.‰∏ñÁïå„ÅÆÂßø'},
                {id: 'geo_japan_overview', name: '2.Êó•Êú¨„ÅÆÂßø'},
                {id: 'geo_world_life', name: '3.‰∏ñÁïåÂêÑÂú∞„ÅÆ‰∫∫„ÄÖ„ÅÆÁîüÊ¥ª„Å®Áí∞Â¢É'},
                {id: 'geo_asia', name: '4.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄ„Ç¢„Ç∏„Ç¢Â∑û'},
                {id: 'geo_europe', name: '5.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄ„É®„Éº„É≠„ÉÉ„ÉëÂ∑û'},
                {id: 'geo_africa', name: '6.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄ„Ç¢„Éï„É™„Ç´Â∑û'},
                {id: 'geo_north_america', name: '7.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄÂåó„Ç¢„É°„É™„Ç´Â∑û'},
                {id: 'geo_south_america', name: '8.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄÂçó„Ç¢„É°„É™„Ç´Â∑û'},
                {id: 'geo_oceania', name: '9.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄ„Ç™„Çª„Ç¢„Éã„Ç¢'},
                {id: 'geo_japan_features', name: '10.Êó•Êú¨„ÅÆÂú∞ÂüüÁöÑÁâπËâ≤'}
            ],
            history: [
                {id: 'hist_ancient', name: '1.ÊñáÊòé„ÅÆ„Åä„Åì„Çä„Å®Êó•Êú¨„ÅÆÊàê„ÇäÁ´ã„Å°'},
                {id: 'hist_ancient_state', name: '2.Âè§‰ª£ÂõΩÂÆ∂„ÅÆÊ≠©„Åø„Å®Êù±„Ç¢„Ç∏„Ç¢'},
                {id: 'hist_kamakura', name: '3.Ê≠¶Â£´„ÅÆ„Åä„Åì„Çä„Å®ÈéåÂÄâÂπïÂ∫ú'},
                {id: 'hist_muromachi', name: '4.„É¢„É≥„Ç¥„É´„ÅÆË•≤Êù•„Å®ÂÆ§Áî∫ÂπïÂ∫ú'},
                {id: 'hist_unification', name: '5.„É®„Éº„É≠„ÉÉ„Éë‰∫∫„Å®„ÅÆÂá∫‰ºö„ÅÑ„Å®ÂÖ®ÂõΩÁµ±‰∏Ä'},
                {id: 'hist_edo_early', name: '6.Ê±üÊà∏ÂπïÂ∫ú„ÅÆÊàêÁ´ã„Å®ÈéñÂõΩ'},
                {id: 'hist_edo_develop', name: '7.Áî£Ê•≠„ÅÆÁô∫ÈÅî„Å®ÂπïÂ∫úÊîøÊ≤ª„ÅÆÂ±ïÈñã'},
                {id: 'hist_opening', name: '8.Ê¨ßÁ±≥„ÅÆÈÄ≤Âá∫„Å®Êó•Êú¨„ÅÆÈñãÂõΩ'},
                {id: 'hist_meiji', name: '9.ÊòéÊ≤ªÁ∂≠Êñ∞'}
            ],
            civics: [
                {id: 'civics_modern', name: '1.Áèæ‰ª£Á§æ‰ºö„Å®ÁßÅ„Åü„Å°'},
                {id: 'civics_constitution', name: '2.‰∫∫Èñì„ÅÆÂ∞äÈáç„Å®Êó•Êú¨ÂõΩÊÜ≤Ê≥ï'},
                {id: 'civics_democracy', name: '3.Áèæ‰ª£„ÅÆÊ∞ë‰∏ªÊîøÊ≤ª'},
                {id: 'civics_economy', name: '4.ÊöÆ„Çâ„Åó„Å®ÁµåÊ∏à'}
            ],
            chemistry: [
                {id: 'chemistry_basic', name: '1.Áâ©Ë≥™„Å®„Åù„ÅÆÊÄßË≥™'},
                {id: 'chemistry_gas', name: '2.Ê∞ó‰Ωì„ÅÆÊÄßË≥™'},
                {id: 'chemistry_solution', name: '3.Ê∞¥Ê∫∂Ê∂≤„ÅÆÊÄßË≥™'},
                {id: 'chemistry_state', name: '4.Áä∂ÊÖãÂ§âÂåñ'},
                {id: 'chemistry_change', name: '5.Áâ©Ë≥™„ÅÆÂ§âÂåñ'},
                {id: 'chemistry_structure', name: '6.Áâ©Ë≥™„ÅÆÊàê„ÇäÁ´ã„Å°'},
                {id: 'chemistry_reaction', name: '7.Áâ©Ë≥™„Å©„ÅÜ„Åó„ÅÆÂåñÂ≠¶Â§âÂåñ'},
                {id: 'chemistry_mass', name: '8.ÂåñÂ≠¶Â§âÂåñ„Å®Ë≥™Èáè'}
            ],
            biology: [
                {id: 'biology_flower', name: '1.Ëä±„ÅÆ„Å§„Åè„Çä'},
                {id: 'biology_plant', name: '2.Ê†π„ÉªËëâ„ÅÆ„Å§„Åè„Çä„ÄÅÊ§çÁâ©„ÅÆÁâπÂæ¥„Å®ÂàÜÈ°û'},
                {id: 'biology_animal', name: '3.ÂãïÁâ©„ÅÆÁâπÂæ¥„Å®ÂàÜÈ°û'},
                {id: 'biology_microscope', name: '4.È°ïÂæÆÈè°„ÅÆ‰Ωø„ÅÑÊñπ'},
                {id: 'biology_cell', name: '5.ÁîüÁâ©„Å®Á¥∞ËÉû'},
                {id: 'biology_plant_body', name: '6.Ê§çÁâ©„ÅÆ„Åã„Çâ„Å†„ÅÆ„Å§„Åè„Çä„ÄÅÊ§çÁâ©„Å®Êó•ÂÖâ'},
                {id: 'biology_digestion', name: '7.Ê∂àÂåñ„Å®Âê∏Âèé'},
                {id: 'biology_breathing', name: '8.ÂëºÂê∏'}
            ],
            physics: [
                {id: 'physics_light', name: '1.ÂÖâ„Å´„Çà„ÇãÁèæË±°'},
                {id: 'physics_sound', name: '2.Èü≥„Å´„Çà„ÇãÁèæË±°'},
                {id: 'physics_force', name: '3.Âäõ„Å´„Çà„ÇãÁèæË±°'},
                {id: 'physics_current', name: '4.ÈõªÊµÅ„Å®ÈõªÂúß'},
                {id: 'physics_energy', name: '5.ÈõªÊ∞ó„Ç®„Éç„É´„ÇÆ„Éº'},
                {id: 'physics_magnetic', name: '6.ÈõªÊµÅ„Å®Á£ÅÁïå'}
            ],
            earth: [
                {id: 'earth_volcano', name: '1.ÁÅ´Â±±'},
                {id: 'earth_earthquake', name: '2.Âú∞Èúá'},
                {id: 'earth_strata', name: '3.Âú∞Â±§„ÅÆ„Åß„ÅçÊñπ'},
                {id: 'earth_weather', name: '4.Ê∞óË±°„ÅÆË¶≥Ê∏¨„ÄÅÂ§ßÊ∞óÂúß„Å®ÂúßÂäõ'},
                {id: 'earth_front', name: '5.Ê∞óÂõ£„Å®ÂâçÁ∑ö„ÄÅÊó•Êú¨„ÅÆÂ§©Ê∞ó'},
                {id: 'earth_cloud', name: '6.Èõ≤„ÅÆ„Åß„ÅçÊñπ„Å®Ê∞¥Ëí∏Ê∞ó'}
            ],
            english_words: [
                {id: 'words_time', name: 'Êúà„ÉªÂ∫èÊï∞'},
                {id: 'words_week', name: 'ÊõúÊó•'},
                {id: 'words_timeday', name: 'ÊôÇ„ÉªÊôÇÈñìÂ∏Ø„Å™„Å©'},
                {id: 'words_season', name: 'Â≠£ÁØÄ„ÉªÂÆ∂Êóè'},
                {id: 'words_sports', name: '„Çπ„Éù„Éº„ÉÑ„ÉªÊïôÁßë'}
            ],
            english_phrases: [
                {id: 'phrases_verb', name: '„Çà„ÅèÂá∫„ÇãÂãïË©û„ÅÆÁÜüË™û'},
                {id: 'phrases_set', name: '„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„Å¶„Åä„Åç„Åü„ÅÑÁÜüË™û'},
                {id: 'phrases_similar', name: 'ÊÑèÂë≥„ÅÆ‰ºº„Å¶„ÅÑ„ÇãÁÜüË™û'}
            ],
            english_grammar: [
                {id: 'grammar_irregular_past', name: '‰∏çË¶èÂâáÂãïË©û - ÈÅéÂéªÂΩ¢„ÉªÈÅéÂéªÂàÜË©û'},
                {id: 'grammar_irregular_same', name: '‰∏çË¶èÂâáÂãïË©û - ÈÅéÂéªÂΩ¢„Å®ÈÅéÂéªÂàÜË©û„ÅåÂêå„Åò'},
                {id: 'grammar_be_past', name: 'be ÂãïË©û - ÈÅéÂéªÂΩ¢„ÉªÈÅéÂéªÂàÜË©û'}
            ]
        };

        /* ----------------- „Ç≤„Éº„É†Â§âÊï∞ ----------------- */
        let selectedCategories = [];
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let totalCount = 0;
        let usedQuestions = [];
        let currentSubject = '';
        let questionMode = 'random';
        let sequentialIndex = 0;

        /* ----------------- „É°„ÉÉ„Çª„Éº„Ç∏ÂÆöÁæ© ----------------- */
        const nekoMessages = {
            correct: [
                '„Åô„Åî„ÅÑ„Å´„ÇÉ„Äú‚ô™', 'Ê≠£Ëß£„Å†„Å´„ÇÉÔºÅ', '„ÇÑ„Å£„Åü„Å´„ÇÉ„ÄúÔºÅ', 'Â§©Êâç„Å´„ÇÉ‚ô™', '„Åã„Åó„Åì„ÅÑ„Å´„ÇÉ„Äú',
                '„Å∞„Å£„Å°„Çä„Å´„ÇÉÔºÅ', '„Åô„Å∞„Çâ„Åó„ÅÑ„Å´„ÇÉ‚ô™', '„Åï„Åô„Åå„Å´„ÇÉ„Äú', '„Åà„Çâ„ÅÑ„Å´„ÇÉÔºÅ', '„Å±„Éº„Åµ„Åá„Åè„Å®„Å´„ÇÉ‚ô™'
            ],
            wrong: [
                '„Åñ„Çì„Å≠„Çì„Å´„ÇÉ„Äú', '„Åä„Åó„ÅÑ„Å´„ÇÉÔºÅ', '„Å§„Åé„Åå„Çì„Å∞„Çã„Å´„ÇÉ„Äú', '„Å©„Çì„Åæ„ÅÑ„Å´„ÇÉ‚ô™', '„Åä„Åó„Åã„Å£„Åü„Å´„ÇÉ„Äú',
                '„ÇÇ„ÅÜÂ∞ë„Åó„Å´„ÇÉÔºÅ', '„Éï„Ç°„Ç§„Éà„Å´„ÇÉ„Äú‚ô™', '„Å§„Åé„ÅØ„Åß„Åç„Çã„Å´„ÇÉÔºÅ', '„Åå„Çì„Å∞„Çã„Å´„ÇÉ„Äú', '„ÅÇ„Åç„Çâ„ÇÅ„Å™„ÅÑ„Å´„ÇÉ‚ô™'
            ],
            tap: [
                '„Å´„ÇÉ„Äú„Çì‚ô™', '„ÅΩ„Çì„ÅΩ„Çì‚ô™', '„Åç„ÇÉ„Çè„ÅÑ„ÅÑ„Äú', '„ÇÇ„Åµ„ÇÇ„Åµ‚ô™', '„Åµ„Çè„Åµ„Çè„Äú',
                '„Å∫„Çç„Å∫„Çç‚ô™', '„ÅΩ„Çà„ÅΩ„Çà„Äú', '„Åç„Çâ„Åç„Çâ‚ô™', '„Å¥„Åã„Å¥„Åã„Äú', '„Çè„Åè„Çè„Åè‚ô™'
            ],
            start: [
                '„ÅØ„Åò„Åæ„Çã„Å´„ÇÉ„Äú‚ô™', '„Åå„Çì„Å∞„Çã„Å´„ÇÉÔºÅ', '„Çà„Çç„Åó„Åè„Å´„ÇÉ„Äú', '„Åü„ÅÆ„Åó„ÇÇ„ÅÜ„Å´„ÇÉ‚ô™', '„Åô„Åü„Éº„Å®„Å´„ÇÉ„ÄúÔºÅ'
            ]
        };

        /* ----------------- „Ç∞„É≠„Éº„Éê„É´„Ç§„É≥„Çπ„Çø„É≥„Çπ ----------------- */
        let tiltSystem;
        let soundSystem;
        let pointSystem;
        let voiceSystem;

        /* ----------------- „Ç®„Éï„Çß„ÇØ„ÉàÈñ¢Êï∞ ----------------- */
        function createNekoParticle(text, color, x, y) {
            const particle = document.createElement('div');
            particle.className = 'cute-particle';
            particle.textContent = text;
            particle.style.color = color;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.fontSize = '16px';
            document.body.appendChild(particle);

            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 1500);
        }

        function createNekoParticles(x, y, emojis, count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const emoji = emojis[Math.floor(Math.random() * emojis.length)];
                    const offsetX = (Math.random() - 0.5) * 50;
                    const offsetY = (Math.random() - 0.5) * 50;
                    createNekoParticle(emoji, '#d2691e', x + offsetX, y + offsetY);
                }, i * 40);
            }
        }

        function showNekoMsg(text, x, y) {
            const el = document.createElement('div');
            el.className = 'floating-msg';
            el.textContent = text;
            el.style.left = Math.min(x, window.innerWidth - 80) + 'px';
            el.style.top = Math.min(y, window.innerHeight - 40) + 'px';
            document.body.appendChild(el);

            setTimeout(() => el.remove(), 2000);
        }

        function showNotification(text) {
            console.log('ÈÄöÁü•:', text);
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const nekoText = text + (text.includes('„Å´„ÇÉ') ? '' : '„Å´„ÇÉ„Äú‚ô™');

            notificationText.textContent = nekoText;
            notification.classList.add('show');

            if (soundSystem) soundSystem.playClick();

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function addTapEffect(element) {
            element.addEventListener('click', function(e) {
                this.classList.add('tapped');
                setTimeout(() => this.classList.remove('tapped'), 600);

                const rect = this.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                createNekoParticles(centerX, centerY, ['‚ú®', 'üåü', 'üí´', 'üíñ'], 3);

                const message = nekoMessages.tap[Math.floor(Math.random() * nekoMessages.tap.length)];
                showNekoMsg(message, centerX, centerY);

                if (soundSystem) soundSystem.playClick();
            });
        }

        /* ----------------- ÈÅ∏ÊäûËÇ¢„Ç∑„É£„ÉÉ„Éï„É´Ê©üËÉΩ ----------------- */
        function shuffleOptions(originalOpts, correctAnswerIndex) {
            const shuffledOpts = [...originalOpts];
            const originalLength = shuffledOpts.length;
            
            for (let i = originalLength - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledOpts[i], shuffledOpts[j]] = [shuffledOpts[j], shuffledOpts[i]];
            }
            
            const correctAnswerText = originalOpts[correctAnswerIndex];
            const newCorrectIndex = shuffledOpts.findIndex(option => option === correctAnswerText);
            
            return {
                shuffledOpts: shuffledOpts,
                newCorrectIndex: newCorrectIndex
            };
        }

        /* ----------------- „Çø„Ç§„Éà„É´Áå´„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ ----------------- */
        function bounceCat(side) {
            const catId = side === 'left' ? 'leftCat' : 'rightCat';
            const catElement = document.getElementById(catId);
            if (!catElement) return;
            
            catElement.classList.add('bounce');

            if (soundSystem) soundSystem.playSuccess();

            const rect = catElement.getBoundingClientRect();
            createNekoParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®', 'üåü'], 3);

            const message = '„Å´„ÇÉ„Äú„Çì‚ô™';
            showNekoMsg(message, rect.left + rect.width/2, rect.top + rect.height/2);

            setTimeout(() => {
                catElement.classList.remove('bounce');
            }, 800);
        }

        function bounceTitle() {
            const titleElement = document.getElementById('gameTitle');
            if (!titleElement) return;
            
            titleElement.classList.add('title-bounce');

            if (soundSystem) soundSystem.playSuccess();

            const rect = titleElement.getBoundingClientRect();
            createNekoParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®', 'üåü', 'üíñ', 'üéä', 'üéÜ', 'üåà'], 8);

            const message = 'NEKOPON Quiz „Å†„Å´„ÇÉ„Äú‚ô™';
            showNekoMsg(message, rect.left + rect.width/2, rect.top + rect.height/2);

            setTimeout(() => {
                titleElement.classList.remove('title-bounce');
            }, 800);
        }

        function bounceGameCat(side) {
            const catId = side === 'left' ? 'gameLeftCat' : 'gameRightCat';
            const catElement = document.getElementById(catId);
            if (!catElement) return;

            catElement.classList.add('bounce');

            if (soundSystem) soundSystem.playSuccess();

            const rect = catElement.getBoundingClientRect();
            createNekoParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®', 'üåü'], 3);

            const message = '„Ç≤„Éº„É†‰∏≠„Å´„ÇÉ„Äú„Çì‚ô™';
            showNekoMsg(message, rect.left + rect.width/2, rect.top + rect.height/2);

            setTimeout(() => {
                catElement.classList.remove('bounce');
            }, 800);
        }

        function bounceGameTitle() {
            const titleElement = document.querySelector('#gameScreen .game-title');
            if (!titleElement) return;

            titleElement.classList.add('title-bounce');

            if (soundSystem) soundSystem.playSuccess();

            const rect = titleElement.getBoundingClientRect();
            createNekoParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®', 'üåü', 'üíñ', 'üéä', 'üéÜ', 'üåà'], 8);

            const message = '„ÇØ„Ç§„Ç∫‰∏≠„Å†„Å´„ÇÉ„Äú‚ô™';
            showNekoMsg(message, rect.left + rect.width/2, rect.top + rect.height/2);

            setTimeout(() => {
                titleElement.classList.remove('title-bounce');
            }, 800);
        }

        /* ----------------- Ëã±Ë™ûÁô∫Èü≥„Ç∑„Çπ„ÉÜ„É† ----------------- */
        function speakWord(wordToSpeak) {
            if (voiceSystem) {
                voiceSystem.speak(wordToSpeak);
            }
        }

        function isEnglishCategory() {
            return selectedCategories.some(categoryId => 
                categoryId.startsWith('words_') || 
                categoryId.startsWith('phrases_') || 
                categoryId.startsWith('grammar_')
            );
        }

        /* ----------------- ÁîªÈù¢ÈÅ∑ÁßªÈñ¢Êï∞ ----------------- */
        function hideAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('show');
            });
        }

        function goBackToMain() {
            hideAllModals();
            document.getElementById('mainSubjectModal').classList.add('show');
            if (soundSystem) soundSystem.playClick();
        }

        function goBackToSocial() {
            hideAllModals();
            document.getElementById('socialModal').classList.add('show');
            if (soundSystem) soundSystem.playClick();
        }

        function goBackToScience() {
            hideAllModals();
            document.getElementById('scienceModal').classList.add('show');
            if (soundSystem) soundSystem.playClick();
        }

        function goBackToEnglish() {
            hideAllModals();
            document.getElementById('englishModal').classList.add('show');
            if (soundSystem) soundSystem.playClick();
        }

        /* ----------------- „É°„Ç§„É≥Èñ¢Êï∞Áæ§ ----------------- */
        function selectSubject(subject) {
            console.log('ÊïôÁßëÈÅ∏Êäû:', subject);
            
            try {
                if (soundSystem) soundSystem.playSuccess();
                hideAllModals();
                const targetModal = document.getElementById(subject + 'Modal');
                if (targetModal) {
                    targetModal.classList.add('show');
                    showNotification(`${subject}„ÇíÈÅ∏Êäû„Åó„Åü„Å´„ÇÉ„Äú‚ô™`);
                } else {
                    console.error('„É¢„Éº„ÉÄ„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', subject + 'Modal');
                    showNotification('Ê∫ñÂÇô‰∏≠„Å´„ÇÉ„Äú‚ô™');
                }
            } catch (error) {
                console.error('ÊïôÁßëÈÅ∏Êäû„Ç®„É©„Éº:', error);
                showNotification(`${subject}„ÇíÈÅ∏Êäû„Åó„Åæ„Åó„ÅüÔºÅ`);
            }
        }

        function selectCategory(category) {
            console.log('„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû:', category);
            
            try {
                if (soundSystem) soundSystem.playClick();
                selectedCategories = [];
                hideAllModals();

                const modalId = category.split('_')
                    .map((word, index) => index === 0 ? word : word.charAt(0).toUpperCase() + word.slice(1))
                    .join('');

                const modal = document.getElementById(modalId + 'Modal');
                if (modal) {
                    modal.classList.add('show');
                    showNotification(`${category}„Ç´„ÉÜ„Ç¥„É™„ÇíÈñã„ÅÑ„Åü„Å´„ÇÉ„Äú‚ô™`);

                    setTimeout(() => {
                        const modalCard = modal.querySelector('.clean-card');
                        if (modalCard) {
                            modalCard.scrollTop = 0;
                        }
                    }, 50);
                } else {
                    console.error('„É¢„Éº„ÉÄ„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', modalId + 'Modal');
                    showNotification('Ê∫ñÂÇô‰∏≠„Å´„ÇÉ„Äú‚ô™');
                }
            } catch (error) {
                console.error('„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû„Ç®„É©„Éº:', error);
                showNotification(`${category}„ÇíÈÅ∏Êäû„Åó„Åæ„Åó„ÅüÔºÅ`);
            }
        }

        function toggleCategorySelection(subject, categoryId, buttonElement) {
            if (soundSystem) soundSystem.playClick();

            if (selectedCategories.includes(categoryId)) {
                selectedCategories = selectedCategories.filter(id => id !== categoryId);
                buttonElement.classList.remove('active');
            } else {
                selectedCategories.push(categoryId);
                buttonElement.classList.add('active');
            }

            const camelCase = subject.split('_')
                .map((word, index) => index === 0 ? word.charAt(0).toUpperCase() + word.slice(1) : word.charAt(0).toUpperCase() + word.slice(1))
                .join('');

            const startButton = document.getElementById(`start${camelCase}Quiz`);
            if (startButton) {
                startButton.disabled = selectedCategories.length === 0;
                startButton.style.opacity = selectedCategories.length === 0 ? '0.5' : '1';
            }
        }

        function startSelectedQuiz(subject, subjectName) {
            currentSubject = subject;
            hideAllModals();
            document.getElementById('currentCategory').innerHTML = `<span class="rotating-icon">${subjectName}</span> - ${selectedCategories.length}ÂçòÂÖÉÈÅ∏Êäû‰∏≠„Å†„Å´„ÇÉ„Äú‚ô™`;
            document.getElementById('gameScreen').classList.remove('hidden');

            const floatingBtn = document.getElementById('changeSubject');
            floatingBtn.classList.remove('hidden');
            floatingBtn.style.display = 'flex';

            correctCount = 0;
            wrongCount = 0;
            totalCount = 0;
            usedQuestions = [];
            sequentialIndex = 0;

            updateStats();
            showNotification(`${subjectName}„ÅÆ${selectedCategories.length}ÂçòÂÖÉ„ÇíÈÅ∏Êäû„Åó„Åü„Å´„ÇÉ„Äú‚ô™`);
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            document.getElementById('totalCount').textContent = totalCount;

            const statsDisplay = document.querySelector('.stats-display');
            if (statsDisplay) {
                statsDisplay.classList.add('score-pulse');
                setTimeout(() => {
                    statsDisplay.classList.remove('score-pulse');
                }, 600);
            }
        }

        function setQuestionMode(mode) {
            questionMode = mode;

            document.getElementById('randomModeBtn').classList.remove('active');
            document.getElementById('sequentialModeBtn').classList.remove('active');

            if (mode === 'random') {
                document.getElementById('randomModeBtn').classList.add('active');
                document.getElementById('modeDescription').textContent = 'ÂïèÈ°å„Çí„É©„É≥„ÉÄ„É†„Å´Âá∫È°å„Åô„Çã„Å´„ÇÉ„Äú‚ô™';
                usedQuestions = [];
                showNotification('„É©„É≥„ÉÄ„É†Âá∫È°å„Å´Âàá„ÇäÊõø„Åà„Åü„Å´„ÇÉ„Äú');
            } else {
                document.getElementById('sequentialModeBtn').classList.add('active');
                document.getElementById('modeDescription').textContent = 'ÂïèÈ°å„ÇíÈ†ÜÁï™ÈÄö„Çä„Å´Âá∫È°å„Åô„Çã„Å´„ÇÉ„Äú‚ô™';
                sequentialIndex = 0;
                showNotification('È†ÜÁï™ÈÄö„ÇäÂá∫È°å„Å´Âàá„ÇäÊõø„Åà„Åü„Å´„ÇÉ„Äú');
            }
        }

        /* ----------------- „ÇØ„Ç§„Ç∫Ê©üËÉΩ ----------------- */
        function openQuiz() {
            if (selectedCategories.length === 0) {
                showNotification('ÂçòÂÖÉ„ÇíÈÅ∏Êäû„Åó„Å¶„Åª„Åó„ÅÑ„Å´„ÇÉ„Äú');
                return;
            }

            let allProblems = [];
            selectedCategories.forEach(categoryId => {
                if (problemDatabase[categoryId]) {
                    allProblems = allProblems.concat(problemDatabase[categoryId]);
                }
            });

            if (allProblems.length === 0) {
                showNotification('ÂïèÈ°å„Åå„Åæ„Å†Ê∫ñÂÇô‰∏≠„Å†„Å´„ÇÉ„Äú');
                return;
            }

            if (usedQuestions.length >= allProblems.length) {
                usedQuestions = [];
                showNotification('ÂÖ®Âïè„ÇØ„É™„Ç¢„Å†„Å´„ÇÉ„Äú‚ô™ „É™„Çª„ÉÉ„Éà„Åó„Åü„Å´„ÇÉÔºÅ');
            }

            let quiz;
            let remainingCount;

            if (questionMode === 'random') {
                const availableQuestions = allProblems.filter((_, index) => !usedQuestions.includes(index));
                if (availableQuestions.length === 0) return;

                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                quiz = availableQuestions[randomIndex];
                const originalIndex = allProblems.indexOf(quiz);
                usedQuestions.push(originalIndex);
                remainingCount = allProblems.length - usedQuestions.length;
            } else {
                if (sequentialIndex >= allProblems.length) {
                    sequentialIndex = 0;
                    showNotification('ÂÖ®ÂïèÈ°å„Çí‰∏ÄÂë®„Åó„Åü„Å´„ÇÉ„Äú‚ô™ ÊúÄÂàù„Åã„ÇâÂÜçÈñã„Å´„ÇÉÔºÅ');
                }
                quiz = allProblems[sequentialIndex];
                sequentialIndex++;
                remainingCount = allProblems.length - sequentialIndex;
                if (remainingCount < 0) remainingCount = 0;
            }

            const shuffleResult = shuffleOptions(quiz.opts, quiz.ans);
            const shuffledOpts = shuffleResult.shuffledOpts;
            const newCorrectIndex = shuffleResult.newCorrectIndex;

            const modal = document.getElementById('quizModal');
            const qEl = document.getElementById('quizQ');
            const optDiv = document.getElementById('quizOptions');
            const msgEl = document.getElementById('quizMsg');
            const explanationEl = document.getElementById('quizExplanation');

            qEl.textContent = `${quiz.q} (ÊÆã„Çä${remainingCount}Âïè„Å†„Å´„ÇÉ„Äú)`;
            optDiv.innerHTML = '';
            msgEl.textContent = '';
            explanationEl.classList.remove('has-content');

            if (isEnglishCategory()) {
                speakWord(quiz.q);
            }

            let firstAnswer = false;

            shuffledOpts.forEach((txt, i) => {
                const btn = document.createElement('button');
                btn.textContent = txt;
                btn.className = 'quiz-option w-full tap-effect clickable-element';
                addTapEffect(btn);

                btn.onclick = () => {
                    if (isEnglishCategory()) {
                        speakWord(txt);
                    }

                    if (!firstAnswer) {
                        firstAnswer = true;
                        totalCount++;

                        if (i === newCorrectIndex) {
                            correctCount++;
                            if (soundSystem) soundSystem.playCorrect();

                            const correctMsg = nekoMessages.correct[Math.floor(Math.random() * nekoMessages.correct.length)];
                            showNotification(correctMsg);

                            const rect = btn.getBoundingClientRect();
                            createNekoParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['‚ú®', 'üåü', 'üí´', 'üéâ', 'üéä'], 5);

                            if (pointSystem) {
                                pointSystem.sparklePoints += 500;
                                pointSystem.firePoints += 250;
                                pointSystem.trophyPoints += 1000;
                                pointSystem.updateAllPointDisplays();
                                pointSystem.showFloatingPoints(1750, rect.left + rect.width/2, rect.top + rect.height/2, 'ultra');
                            }
                        } else {
                            wrongCount++;
                            if (soundSystem) soundSystem.playWrong();

                            const wrongMsg = nekoMessages.wrong[Math.floor(Math.random() * nekoMessages.wrong.length)];
                            showNotification(wrongMsg);

                            if (pointSystem) {
                                pointSystem.sparklePoints += 50;
                                pointSystem.firePoints += 25;
                                pointSystem.trophyPoints += 100;
                                pointSystem.updateAllPointDisplays();
                                pointSystem.showFloatingPoints(175, rect.left + rect.width/2, rect.top + rect.height/2, 'bonus');
                            }
                        }

                        updateStats();
                    }

                    if (i === newCorrectIndex) {
                        msgEl.innerHTML = `üéâ Ê≠£Ëß£„Å†„Å´„ÇÉ„Äú‚ô™ ${quiz.exp || ''}`;
                        msgEl.style.color = 'var(--light-brown)';
                    } else {
                        msgEl.innerHTML = `‚ùå ÊÆãÂøµ„Å´„ÇÉ„Äú...Ê≠£Ëß£„ÅØ„Äå${shuffledOpts[newCorrectIndex]}„Äç„Å†„Å´„ÇÉ‚ô™ ${quiz.exp || ''}`;
                        msgEl.style.color = '#cd5c5c';
                    }

                    explanationEl.classList.add('has-content');
                };

                optDiv.appendChild(btn);
            });

            modal.classList.add('show');
        }

        function loadNextQuiz() {
            if (soundSystem) soundSystem.playSuccess();
            document.getElementById('quizModal').classList.remove('show');
            openQuiz();
        }

        function closeQuiz() {
            if (soundSystem) soundSystem.playClick();
            document.getElementById('quizModal').classList.remove('show');
            showNotification('„ÅäÁñ≤„ÇåÊßò„Å†„Å£„Åü„Å´„ÇÉ„Äú‚ô™');
        }

        function changeSubject() {
            if (soundSystem) soundSystem.playClick();

            selectedCategories = [];
            sequentialIndex = 0;
            usedQuestions = [];

            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('changeSubject').classList.add('hidden');
            goBackToMain();

            showNotification('ÊïôÁßëÈÅ∏Êäû„Å´Êàª„Å£„Åü„Å´„ÇÉ„Äú‚ô™');
        }

        /* ----------------- Èü≥Â£∞Ë®≠ÂÆöÈñ¢Êï∞ ----------------- */
        function openVoiceSettings() {
            document.getElementById('voiceSettingsModal').classList.add('show');
            if (soundSystem) soundSystem.playSuccess();
        }

        function closeVoiceSettings() {
            document.getElementById('voiceSettingsModal').classList.remove('show');
            if (soundSystem) soundSystem.playClick();
            showNotification('Èü≥Â£∞Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åü„Å´„ÇÉ„Äú‚ô™');
        }

        function testVoice(voiceId) {
            if (voiceSystem) {
                voiceSystem.testVoice(voiceId);
            }
        }

        /* ----------------- ÈáçÂäõÊÑüÁü•Èñ¢Êï∞ ----------------- */
        function requestTiltPermission() {
            if (tiltSystem) {
                tiltSystem.requestTiltPermission();
            }
        }

        function skipTiltPermission() {
            if (tiltSystem) {
                tiltSystem.skipTiltPermission();
            }
        }

        /* ----------------- „Ç´„ÉÜ„Ç¥„É™„ÉºÈÅ∏Êäû„ÅÆÂàùÊúüÂåñ ----------------- */
        function initCategorySelection() {
            // Âú∞ÁêÜ„Ç´„ÉÜ„Ç¥„É™„Éº
            const geographyContainer = document.getElementById('geographyCategories');
            if (geographyContainer) {
                categories.geography.forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('geography', category.id, btn);
                    addTapEffect(btn);
                    geographyContainer.appendChild(btn);
                });
            }

            // Ê≠¥Âè≤„Ç´„ÉÜ„Ç¥„É™„Éº
            const historyContainer = document.getElementById('historyCategories');
            if (historyContainer) {
                categories.history.forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('history', category.id, btn);
                    addTapEffect(btn);
                    historyContainer.appendChild(btn);
                });
            }

            // ÂÖ¨Ê∞ë„Ç´„ÉÜ„Ç¥„É™„Éº
            const civicsContainer = document.getElementById('civicsCategories');
            if (civicsContainer) {
                categories.civics.forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('civics', category.id, btn);
                    addTapEffect(btn);
                    civicsContainer.appendChild(btn);
                });
            }

            // ÂåñÂ≠¶„Ç´„ÉÜ„Ç¥„É™„ÉºÔºàÂ≠¶Âπ¥„Åî„Å®Ôºâ
            const chemistryContainer = document.getElementById('chemistryCategories');
            if (chemistryContainer) {
                const grade1Label = document.createElement('div');
                grade1Label.className = 'grade-label clickable-element';
                grade1Label.textContent = '‰∏≠Â≠¶1Âπ¥Áîü';
                chemistryContainer.appendChild(grade1Label);
                
                categories.chemistry.slice(0, 4).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('chemistry', category.id, btn);
                    addTapEffect(btn);
                    chemistryContainer.appendChild(btn);
                });

                const grade2Label = document.createElement('div');
                grade2Label.className = 'grade-label clickable-element';
                grade2Label.textContent = '‰∏≠Â≠¶2Âπ¥Áîü';
                chemistryContainer.appendChild(grade2Label);
                
                categories.chemistry.slice(4).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('chemistry', category.id, btn);
                    addTapEffect(btn);
                    chemistryContainer.appendChild(btn);
                });
            }

            // ÁîüÁâ©„Ç´„ÉÜ„Ç¥„É™„ÉºÔºàÂ≠¶Âπ¥„Åî„Å®Ôºâ
            const biologyContainer = document.getElementById('biologyCategories');
            if (biologyContainer) {
                const grade1Label = document.createElement('div');
                grade1Label.className = 'grade-label clickable-element';
                grade1Label.textContent = '‰∏≠Â≠¶1Âπ¥Áîü';
                biologyContainer.appendChild(grade1Label);
                
                categories.biology.slice(0, 3).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('biology', category.id, btn);
                    addTapEffect(btn);
                    biologyContainer.appendChild(btn);
                });

                const grade2Label = document.createElement('div');
                grade2Label.className = 'grade-label clickable-element';
                grade2Label.textContent = '‰∏≠Â≠¶2Âπ¥Áîü';
                biologyContainer.appendChild(grade2Label);
                
                categories.biology.slice(3).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('biology', category.id, btn);
                    addTapEffect(btn);
                    biologyContainer.appendChild(btn);
                });
            }

            // Áâ©ÁêÜ„Ç´„ÉÜ„Ç¥„É™„ÉºÔºàÂ≠¶Âπ¥„Åî„Å®Ôºâ
            const physicsContainer = document.getElementById('physicsCategories');
            if (physicsContainer) {
                const grade1Label = document.createElement('div');
                grade1Label.className = 'grade-label clickable-element';
                grade1Label.textContent = '‰∏≠Â≠¶1Âπ¥Áîü';
                physicsContainer.appendChild(grade1Label);
                
                categories.physics.slice(0, 3).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('physics', category.id, btn);
                    addTapEffect(btn);
                    physicsContainer.appendChild(btn);
                });

                const grade2Label = document.createElement('div');
                grade2Label.className = 'grade-label clickable-element';
                grade2Label.textContent = '‰∏≠Â≠¶2Âπ¥Áîü';
                physicsContainer.appendChild(grade2Label);
                
                categories.physics.slice(3).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('physics', category.id, btn);
                    addTapEffect(btn);
                    physicsContainer.appendChild(btn);
                });
            }

            // Âú∞Â≠¶„Ç´„ÉÜ„Ç¥„É™„ÉºÔºàÂ≠¶Âπ¥„Åî„Å®Ôºâ
            const earthContainer = document.getElementById('earthCategories');
            if (earthContainer) {
                const grade1Label = document.createElement('div');
                grade1Label.className = 'grade-label clickable-element';
                grade1Label.textContent = '‰∏≠Â≠¶1Âπ¥Áîü';
                earthContainer.appendChild(grade1Label);
                
                categories.earth.slice(0, 3).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('earth', category.id, btn);
                    addTapEffect(btn);
                    earthContainer.appendChild(btn);
                });

                const grade2Label = document.createElement('div');
                grade2Label.className = 'grade-label clickable-element';
                grade2Label.textContent = '‰∏≠Â≠¶2Âπ¥Áîü';
                earthContainer.appendChild(grade2Label);
                
                categories.earth.slice(3).forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('earth', category.id, btn);
                    addTapEffect(btn);
                    earthContainer.appendChild(btn);
                });
            }

            // Ëã±ÂçòË™û„Ç´„ÉÜ„Ç¥„É™„Éº
            const englishWordsContainer = document.getElementById('englishWordsCategories');
            if (englishWordsContainer) {
                categories.english_words.forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('english_words', category.id, btn);
                    addTapEffect(btn);
                    englishWordsContainer.appendChild(btn);
                });
            }

            // Ëã±ÁÜüË™û„Ç´„ÉÜ„Ç¥„É™„Éº
            const englishPhrasesContainer = document.getElementById('englishPhrasesCategories');
            if (englishPhrasesContainer) {
                categories.english_phrases.forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('english_phrases', category.id, btn);
                    addTapEffect(btn);
                    englishPhrasesContainer.appendChild(btn);
                });
            }

            // Ë™ûÂΩ¢Â§âÂåñ„Ç´„ÉÜ„Ç¥„É™„Éº
            const englishGrammarContainer = document.getElementById('englishGrammarCategories');
            if (englishGrammarContainer) {
                categories.english_grammar.forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn tap-effect clickable-element';
                    btn.innerHTML = category.name;
                    btn.dataset.categoryId = category.id;
                    btn.onclick = () => toggleCategorySelection('english_grammar', category.id, btn);
                    addTapEffect(btn);
                    englishGrammarContainer.appendChild(btn);
                });
            }
        }

        /* ----------------- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö ----------------- */
        function initEventListeners() {
            // „Çø„Ç§„Éà„É´„Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà
            const gameTitle = document.getElementById('gameTitle');
            if (gameTitle) {
                gameTitle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    bounceTitle();
                });
            }

            // „Çø„Ç§„Éà„É´Áå´„ÅÆ„Çø„ÉÉ„ÉóÔºà„Éõ„Éº„É†ÁîªÈù¢Ôºâ
            const leftCat = document.getElementById('leftCat');
            if (leftCat) {
                leftCat.addEventListener('click', (e) => {
                    e.stopPropagation();
                    bounceCat('left');
                });
            }

            const rightCat = document.getElementById('rightCat');
            if (rightCat) {
                rightCat.addEventListener('click', (e) => {
                    e.stopPropagation();
                    bounceCat('right');
                });
            }

            // „Ç≤„Éº„É†ÁîªÈù¢„ÅÆÁå´„ÅÆ„Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà
            const gameLeftCat = document.getElementById('gameLeftCat');
            if (gameLeftCat) {
                gameLeftCat.addEventListener('click', (e) => {
                    e.stopPropagation();
                    bounceGameCat('left');
                });
            }

            const gameRightCat = document.getElementById('gameRightCat');
            if (gameRightCat) {
                gameRightCat.addEventListener('click', (e) => {
                    e.stopPropagation();
                    bounceGameCat('right');
                });
            }

            // Èü≥Èüø„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ
            document.addEventListener('click', () => {
                if (soundSystem && soundSystem.audioContext && soundSystem.audioContext.state === 'suspended') {
                    soundSystem.audioContext.resume();
                }
            }, { once: true });

            // Èü≥Â£∞ÂêàÊàê„ÅÆÂàùÊúüÂåñ
            if ('speechSynthesis' in window && typeof speechSynthesis.getVoices === 'function') {
                const voicePolling = setInterval(() => {
                    if (speechSynthesis.getVoices().length) {
                        clearInterval(voicePolling);
                    } else {
                        speechSynthesis.getVoices();
                    }
                }, 200);
            }
        }

        /* ----------------- ÂàùÊúüÂåñÔºàÂÆåÂÖ®ÁâàÔºâ ----------------- */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded - ÂàùÊúüÂåñÈñãÂßã');
            
            try {
                // Âü∫Êú¨„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ
                soundSystem = new SimpleSoundSystem();
                voiceSystem = new SimpleVoiceSystem();
                pointSystem = new SimplePointSystem();
                tiltSystem = new SimpleTiltSystem();

                // Âü∫Êú¨Ê©üËÉΩ„ÅÆÂàùÊúüÂåñ
                initCategorySelection();
                initEventListeners();
                document.getElementById('changeSubject').classList.add('hidden');

                // „Çø„ÉÉ„Éó„Ç®„Éï„Çß„ÇØ„Éà„ÅÆËøΩÂä†
                document.querySelectorAll('.tap-effect').forEach(addTapEffect);

                // ÈáçÂäõÊÑüÁü•„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ
                tiltSystem.init();

                // „Ç¶„Çß„É´„Ç´„É†„É°„ÉÉ„Çª„Éº„Ç∏„Å®„Ç®„Éï„Çß„ÇØ„Éà
                setTimeout(() => {
                    showNotification('NEKOPON Quiz„Å∏„Çà„ÅÜ„Åì„Åù„Å´„ÇÉ„Äú‚ô™');

                    // ÁîªÈù¢ÂÖ®‰Ωì„Å´„Ç¶„Çß„É´„Ç´„É†„Éë„Éº„ÉÜ„Ç£„ÇØ„É´
                    for (let i = 0; i < 15; i++) {
                        setTimeout(() => {
                            const x = Math.random() * window.innerWidth;
                            const y = Math.random() * window.innerHeight;
                            pointSystem.createCuteParticles(x, y, ['üéâ', 'üéä', '‚ú®', 'üåü', 'üí´', 'üê±', 'üìö', 'üéì'], 3);
                        }, i * 200);
                    }
                }, 1000);

                // „ÇØ„É™„ÉÉ„Ç´„ÉºË™¨Êòé
                setTimeout(() => {
                    showNotification('„Å©„Åì„Åß„ÇÇ„Çø„ÉÉ„Éó„Åß„Éù„Ç§„É≥„Éà„Ç≤„ÉÉ„Éà„Å´„ÇÉ„Äú‚ô™');
                }, 4000);

                // Èü≥Â£∞Ê©üËÉΩË™¨Êòé
                setTimeout(() => {
                    showNotification('üéµ„Éú„Çø„É≥„ÅßÈü≥Â£∞Ë®≠ÂÆö„Åå„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™');
                }, 7000);

                // ÈáçÂäõÊÑüÁü•Ë™¨Êòé
                setTimeout(() => {
                    if (tiltSystem.tiltEnabled) {
                        showNotification('„Çπ„Éû„Éõ„ÇíÂÇæ„Åë„Çã„Å®„Ç¢„Ç§„Ç≥„É≥„Åå„ÇØ„É´„ÇØ„É´Âõû„Çã„Å´„ÇÉ„Äú‚ô™');
                    }
                }, 10000);

                // ËøΩÂä†„ÅÆ„Éí„É≥„Éà
                setTimeout(() => {
                    showNotification('„Éù„Ç§„É≥„Éà„Éê„Éñ„É´„ÇÇÁõ¥Êé•„Çø„ÉÉ„Éó„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™');
                }, 13000);

                // ÈÅ∏ÊäûËÇ¢„Ç∑„É£„ÉÉ„Éï„É´Ê©üËÉΩ„ÅÆÁ¥π‰ªã
                setTimeout(() => {
                    showNotification('ÈÅ∏ÊäûËÇ¢„ÅÆ‰ΩçÁΩÆ„Åå„É©„É≥„ÉÄ„É†„Å´Â§â„Çè„Çã„Å´„ÇÉ„Äú‚ô™');
                }, 16000);

                console.log('ÂàùÊúüÂåñÂÆå‰∫Ü');
                
            } catch (error) {
                console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                showNotification('ÂàùÊúüÂåñ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„Åå„ÄÅ„Éú„Çø„É≥„ÅØÂãï‰Ωú„Åô„Çã„ÅØ„Åö„Åß„Åô„ÄÇ');
            }
        });
        
        // „Ç¶„Ç£„É≥„Éâ„Ç¶„É≠„Éº„ÉâÂæå„Å´„ÇÇÂÜçÁ¢∫Ë™ç
        window.addEventListener('load', () => {
            console.log('window.onload - ÊúÄÁµÇÁ¢∫Ë™ç');
            
            // „Éú„Çø„É≥„ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÊúÄÁµÇÁ¢∫Ë™ç
            const buttons = document.querySelectorAll('.subject-btn');
            buttons.forEach(btn => {
                if (!btn.onclick) {
                    console.log('onclick„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Éú„Çø„É≥„Çí‰øÆÊ≠£:', btn.dataset.subject);
                    btn.onclick = () => selectSubject(btn.dataset.subject);
                }
            });
            
            showNotification('„Åô„Åπ„Å¶Ê∫ñÂÇôÂÆå‰∫Ü„Å´„ÇÉ„Äú‚ô™ „Éú„Çø„É≥„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Å´„ÇÉÔºÅ');
        });

        // Á∑äÊÄ•Áî®Ôºö„ÇØ„É™„ÉÉ„ÇØ„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
        document.addEventListener('click', (e) => {
            const target = e.target.closest('.subject-btn');
            if (target && target.dataset.subject) {
                console.log('Á∑äÊÄ•„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ:', target.dataset.subject);
                selectSubject(target.dataset.subject);
            }
            
            const categoryTarget = e.target.closest('[data-category]');
            if (categoryTarget && categoryTarget.dataset.category) {
                console.log('Á∑äÊÄ•„Ç´„ÉÜ„Ç¥„É™„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ:', categoryTarget.dataset.category);
                selectCategory(categoryTarget.dataset.category);
            }
        });
    </script>
</body>
</html>